(this["webpackJsonpweb-soins-consultations"]=this["webpackJsonpweb-soins-consultations"]||[]).push([[0],{25:function(e,t){e.exports=require("crypto")},26:function(e){e.exports=JSON.parse('{"name":"web-soins-consultations","version":"0.6.0","private":true,"dependencies":{"@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.5.0","@testing-library/user-event":"^7.2.1","@types/jest":"^24.9.1","@types/node":"^12.12.54","@types/react":"^16.9.46","@types/react-dom":"^16.9.8","@types/react-redux":"^7.1.9","@types/uuid":"^8.3.0","nw-react-scripts":"3.4.1","react":"^16.13.1","react-dom":"^16.13.1","react-redux":"^7.2.1","redux":"^4.0.5","tfw":"^0.37.0","typescript":"^3.9.7","uuid":"^8.3.0"},"scripts":{"postbuild":"cd build ; rm -rf web-soins-consultations/ ; find . -type f -exec sha256sum {} \\\\; > package.txt","start":"REACT_APP_WEBSOINS=DEV nw-react-scripts start","build":"nw-react-scripts build","deploy":"gh-pages -d build","test":"nw-react-scripts test","eject":"nw-react-scripts eject"},"eslintConfig":{"extends":"nw-react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"main":"index.html","window":{"fullscreen":true,"width":1280,"height":720},"nwBuilder":{"//":"https://github.com/nwjs-community/nw-builder","platforms":["win64"],"version":"latest","flavor":"normal","buildDir":"./build","cacheDir":"./cache","macIcns":"./src/logo.icns"},"devDependencies":{"gh-pages":"^3.1.0"}}')},27:function(e,t,n){e.exports=n(87)},69:function(e,t,n){},70:function(e,t,n){},71:function(e){e.exports=JSON.parse('{"fr":{"back":"Retour","birthday":"Date de naissance","cancel":"Annuler","close":"Fermer","code":"Code :","consultation-date":"Date de consultation","consultations":"Consultations","consultations-count":"Nb Consultations :","country":"Pays","date-min":"Date de d\xe9but","date-max":"Date de fin","edit-patient":"Editer le Patient","filter":"Filtre","firstname":"Pr\xe9nom","gender":"Genre","gender-female":"F\xe9minin","gender-male":"Masculin","gender-undefined":"Non d\xe9fini","identifier":"ID","import-patients":"Importer des dossiers patients","lastname":"Nom","loading":"Chargement en cours...","logout":"D\xe9connexion","new-consultation":"Nouvelle consultation","ok":"Valider","patients":"Patients","patients-count":"Nb Patients :","secondname":"Second Pr\xe9nom","size":"Taille (cm)","struct":"Structure :","vaccins":"Vaccins"}}')},72:function(e,t){e.exports=require("path")},73:function(e,t){e.exports=require("fs")},74:function(e,t,n){},75:function(e,t,n){},76:function(e,t,n){},77:function(e,t,n){},78:function(e,t,n){},79:function(e,t,n){},80:function(e,t,n){},81:function(e,t,n){},82:function(e,t,n){},83:function(e,t,n){},84:function(e,t,n){},85:function(e,t,n){},86:function(e){e.exports=JSON.parse('{"fr":{"err-1":"Une ligne non vide et non comment\xe9e doit toujours commencer par au moins une ast\xe9risque pour indiquer le niveau hi\xe9rarchique.","err-2":"<html>Vous avez saut\xe9 au moins un niveau hi\xe9rarchique:<br/><code>$1</code> !<br/><br/>Vous \xe9tiez au niveau <b>$2</b> et vous d\xe9finissez maintenant le niveau <b>$3</b>.","err-3":"<html>Vous avez d\xe9j\xe0 d\xe9clar\xe9 cet identifiant : <b>$1</b> !"}}')},87:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),i=n(5),o=n(1),s=n(0),c=n.n(s),u=n(11),l=n.n(u),d=n(18),p=(n(69),n(9)),f=n(17),m={createUndefinedDate:function(){return new Date(-30610224561e3)},date2seconds:function(e){return Math.floor(.001*e.getTime())},formatDate:function(e){return h.format(e)},isDefinedDate:function(e){if(e instanceof Date)return e.getTime()>-30610224561e3;return!1},seconds2date:function(e){return new Date(1e3*e)}};var h=new Intl.DateTimeFormat(["fr-CM"],{weekday:"long",year:"numeric",month:"long",day:"numeric"});var v={consultationId:"",page:"patients",patient:{id:"",lastname:"",firstname:"",secondname:"",gender:"X",size:0,country:"",birth:m.createUndefinedDate()},patients:[]},g=Object(f.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"set-consultation-id":return Object(p.a)(Object(p.a)({},e),{},{consultationId:t.consultationId});case"set-page":return Object(p.a)(Object(p.a)({},e),{},{page:t.page});case"set-patient":return Object(p.a)(Object(p.a)({},e),{},{patient:t.patient});case"set-patients":return Object(p.a)(Object(p.a)({},e),{},{patients:t.patients});default:return e}}));var b={store:g,clearPatient:function(){y({type:"set-patient",patient:{id:"",firstname:"",secondname:"",lastname:"",birth:new Date,country:"",gender:"",size:0}})},setConsultationId:function(e){y({type:"set-consultation-id",consultationId:e})},setPage:function(e){y({type:"set-page",page:e})},setPatient:function(e){y({type:"set-patient",patient:e})},setPatients:function(e){y({type:"set-patients",patients:e})}};function y(e){console.trace("DISPATCH",e),g.dispatch(e)}var C=n(7),E=n(4),w=n(3),O=n(8),j=n(6),k=(n(70),function(){var e=document.getElementById("splash-screen");if(e){e.classList.add("vanish");window.setTimeout((function(){return document.body.removeChild(e)}),1e3)}}),P=o.a.Intl.make(n(71)),S={get back(){return P("back")},get birthday(){return P("birthday")},get cancel(){return P("cancel")},get close(){return P("close")},get code(){return P("code")},get consultationDate(){return P("consultation-date")},get consultations(){return P("consultations")},get consultationsCount(){return P("consultations-count")},get country(){return P("country")},get dateMin(){return P("date-min")},get dateMax(){return P("date-max")},get editPatient(){return P("edit-patient")},get executeQuery(){return P("execute-query")},get extractions(){return P("extractions")},get filter(){return P("filter")},get firstName(){return P("firstname")},get gender(){return P("gender")},genderValue:function(e){switch(e.trim().toUpperCase()){case"M":return P("gender-male");case"F":return P("gender-female");default:return P("gender-undefined")}},get identifier(){return P("identifier")},get importPatients(){return P("import-patients")},get lastName(){return P("lastname")},get loading(){return P("loading")},get logout(){return P("logout")},get newConsultation(){return P("new-consultation")},get ok(){return P("ok")},get patients(){return P("patients")},get patientsCount(){return P("patients-count")},get secondName(){return P("secondname")},get size(){return P("size")},get struct(){return P("struct")},get vaccins(){return P("vaccins")}},N=n(72),x=n(73),A=parseInt("0777",8);function I(e,t,n,a){"function"===typeof t?(n=t,t={}):t&&"object"===typeof t||(t={mode:t});var r=t.mode,i=t.fs||x;void 0===r&&(r=A&~process.umask()),a||(a=null);var o=n||function(){};e=N.resolve(e),i.mkdir(e,r,(function(n){if(!n)return o(null,a=a||e);switch(n.code){case"ENOENT":I(N.dirname(e),t,(function(n,a){n?o(n,a):I(e,t,o,a)}));break;default:i.stat(e,(function(e,t){e||!t.isDirectory()?o(n,a):o(null,a)}))}}))}I.sync=function e(t,n,a){n&&"object"===typeof n||(n={mode:n});var r=n.mode,i=n.fs||x;void 0===r&&(r=A&~process.umask()),a||(a=null),t=N.resolve(t);try{i.mkdirSync(t,r),a=a||t}catch(s){switch(s.code){case"ENOENT":a=e(N.dirname(t),n,a),e(t,n,a);break;default:var o;try{o=i.statSync(t)}catch(c){throw s}if(!o.isDirectory())throw s}}return a};var T=window.require("fs"),D=window.require("path"),F={exists:function(e){var t=D.resolve(z,e);return T.existsSync(t)},readText:function(e){return new Promise((function(t,n){var a=D.resolve(z,e);T.readFile(a,"utf-8",(function(e,a){e?n(e):t(a)}))}))},writeText:function(e,t){return new Promise((function(n,a){var r=D.resolve(z,e);I(D.dirname(r),(function(e){e?a(e):T.writeFile(r,t,"utf-8",(function(e,t){e?a(e):n(t)}))}))}))}},z=D.resolve(process.cwd(),"data");var B={remoteServer:"https://web-soins.com",secretCode:"kAcGObgfMr",organizationId:1,structureId:1},V=new(function(){function e(){var t=this;Object(E.a)(this,e),this.data=void 0,this.save=o.a.Async.Debouncer((function(){F.writeText("settings.json",JSON.stringify(t.data))}),300),this.data=B}return Object(w.a)(e,[{key:"initialize",value:function(){var e=Object(i.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.readText("settings.json");case 3:if(t=e.sent,"string"===typeof(n=JSON.parse(t)).remoteServer){e.next=7;break}throw Error("Attribute remoteServer must be a string!");case 7:if("string"===typeof n.secretCode){e.next=9;break}throw Error("Attribute secretCode must be a string!");case 9:if("number"===typeof n.organizationId){e.next=11;break}throw Error("Attribute organizationId must be a number!");case 11:if("number"===typeof n.structureId){e.next=13;break}throw Error("Attribute structureId must be a number!");case 13:return B.remoteServer=n.remoteServer,B.secretCode=n.secretCode,B.organizationId=n.organizationId,B.structureId=n.structureId,B.structure=n.structure,e.abrupt("return",!0);case 21:return e.prev=21,e.t0=e.catch(0),console.error("Unable to load settings.json!"),console.error(e.t0),e.abrupt("return",!1);case 26:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"remoteServer",get:function(){return"DEV"===Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_WEBSOINS?"http://localhost:7474/web-soins/":this.data.remoteServer},set:function(e){this.data.remoteServer=e,this.save()}},{key:"secretCode",get:function(){return this.data.secretCode},set:function(e){this.data.secretCode=e,this.save()}},{key:"organizationId",get:function(){return this.data.organizationId},set:function(e){this.data.organizationId=e,this.save()}},{key:"structureId",get:function(){return this.data.structureId},set:function(e){this.data.structureId=e,this.save()}},{key:"structure",get:function(){return this.data.structure},set:function(e){this.data.structure=e,this.save()}}]),e}()),U=(n(74),function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={},e}return Object(w.a)(n,[{key:"render",value:function(){var e=["view-PatientShortDesc"].concat(Object(C.a)(o.a.Converter.StringArray(this.props.className,[]))),t=this.props.patient;if(!t)return null;if(!V.structure)return null;var n=1+(new Date).getFullYear()-t.birth.getFullYear();return c.a.createElement("div",{className:e.join(" "),title:t.id},c.a.createElement("span",{className:"lastname"},t.lastname.toUpperCase()),c.a.createElement("span",{className:"firstname"},t.firstname),c.a.createElement("span",{className:"secondname"},t.secondname),m.isDefinedDate(t.birth)&&c.a.createElement("span",{className:"age"},n," ",c.a.createElement("em",null,"ans")),t.size>0&&c.a.createElement("span",{className:"size"},t.size," ",c.a.createElement("em",null,"cm")))}}]),n}(c.a.Component)),L=n(10),_=n(89),M=function(){return Object(_.a)()},R={createPatientFromSummary:function(e){var t=M(),n=m.date2seconds(new Date);return{id:t,admissions:[],created:n,attachments:[],data:{id:t,"#PATIENT-LASTNAME":e.lastname,"#PATIENT-FIRSTNAME":e.firstname,"#PATIENT-SECONDNAME":e.secondname,"#PATIENT-BIRTH":m.date2seconds(e.birth),"#PATIENT-GENDER":e.gender,"#PATIENT-COUNTRY":e.country,"#PATIENT-SIZE":e.size},edited:n,exams:[],picture:null,vaccins:{}}},getAllConsultationsBefore:function(e,t){var n,a=[],r=Object(L.a)(e.admissions);try{for(r.s();!(n=r.n()).done;){var i,o=n.value,s=Object(L.a)(o.visits);try{for(s.s();!(i=s.n()).done;){var c=i.value;c.enter<t&&a.push(c)}}catch(u){s.e(u)}finally{s.f()}}}catch(u){r.e(u)}finally{r.f()}return a.sort((function(e,t){return t.enter-e.enter})),a},getConsultationFromUuid:function(e,t){var n,a=Object(L.a)(e.admissions);try{for(a.s();!(n=a.n()).done;){var r,i=n.value,o=Object(L.a)(i.visits);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(s.uuid===t)return s}}catch(c){o.e(c)}finally{o.f()}}}catch(c){a.e(c)}finally{a.f()}return console.warn("No consultation found for Patient ".concat(e.id," with Id ").concat(t,"!")),null},getSummary:function(e){return e.data.id=e.id,J(e.data)},getSummaryFromRecord:J,removeConsultation:function(e,t){var n,a=Object(L.a)(e.admissions);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.visits=r.visits.filter((function(e){return e.uuid!==t}))}}catch(i){a.e(i)}finally{a.f()}return e},updateConsultation:function(e,t){var n,a=Object(L.a)(e.admissions);try{for(a.s();!(n=a.n()).done;){var r,i=n.value,o=Object(L.a)(i.visits);try{for(o.s();!(r=o.n()).done;){var s=r.value;if(s.uuid===t.uuid)return s.version=1+Math.max(s.version,t.version),s.enter=t.enter,s.data=Object(p.a)({},t.data),e}}catch(c){o.e(c)}finally{o.f()}}}catch(c){a.e(c)}finally{a.f()}return e}};function J(e){return{id:e.id,birth:m.seconds2date(o.a.Converter.Integer(e["#PATIENT-BIRTH"])),country:"".concat(e["#PATIENT-COUNTRY"]),firstname:o.a.Util.normalizeFirstname("".concat(e["#PATIENT-FIRSTNAME"])),gender:o.a.Converter.Enum(e["#PATIENT-GENDER"],["#F","#M","#X"],"#X"),lastname:o.a.Util.normalizeLastname("".concat(e["#PATIENT-LASTNAME"])),secondname:o.a.Util.normalizeFirstname("".concat(e["#PATIENT-SECONDNAME"])),size:o.a.Converter.Integer(e["#PATIENT-SIZE"])}}var W=n(15),q={getAllPatients:function(){return G.apply(this,arguments)},getPatient:function(e){return Y.apply(this,arguments)},getSummary:function(e){return R.getSummary(e)},exists:function(e){var t="".concat(".","/").concat(e,"/patient.json");return F.exists(t)},setPatient:function(e){return $.apply(this,arguments)}},H="".concat(".","/patients.json"),K=new Map;function G(){return(G=Object(i.a)(r.a.mark((function e(){var t,n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,X();case 3:return t=e.sent,n=Object.keys(t.records).map((function(e){return t.records[e]})).map((function(e){return[e.id,"".concat(e["#PATIENT-LASTNAME"],"\t").concat(e["#PATIENT-FIRSTNAME"],"\t").concat(e["#PATIENT-SECONDNAME"]),e]})),a=n.sort((function(e,t){var n=Object(W.a)(e,1)[0],a=Object(W.a)(t,1)[0];return n<a?-1:n>a?1:0})),e.abrupt("return",a.map((function(e){return e[2]})).map(R.getSummaryFromRecord));case 9:return e.prev=9,e.t0=e.catch(0),console.error('Unable to load "'.concat(H,'"!'),e.t0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function Y(){return(Y=Object(i.a)(r.a.mark((function e(t){var n,a,i,o,s=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:".",e.prev=1,console.info("getPatient() id=",t),!K.has(t)){e.next=7;break}return a=K.get(t),console.log("Found Patient #".concat(t," in cache!"),a),e.abrupt("return",a);case 7:return e.next=9,F.readText("".concat(n,"/").concat(t,"/patient.json"));case 9:return i=e.sent,ae(o=JSON.parse(i)),K.set(t,o),console.log("Loaded patient: ",o),e.abrupt("return",o);case 17:throw e.prev=17,e.t0=e.catch(1),console.error("Unable to load patient #".concat(t,"!"),e.t0),e.t0;case 21:case"end":return e.stop()}}),e,null,[[1,17]])})))).apply(this,arguments)}function $(){return($=Object(i.a)(r.a.mark((function e(t){var n,a,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=JSON.stringify(ae(t)),Z(t),e.next=5,F.writeText("./".concat(t.id,"/patient.json"),n);case 5:return e.next=7,X();case 7:return a=e.sent,ne(t,a),e.next=11,ee(a);case 11:return i=t.id,K.has(i)&&K.delete(i),K.set(i,t),e.abrupt("return",t);case 17:throw e.prev=17,e.t0=e.catch(0),console.error("Unable to save patient #".concat(t.id,"!"),e.t0),e.t0;case 21:case"end":return e.stop()}}),e,null,[[0,17]])})))).apply(this,arguments)}function Z(e){"string"===typeof e.id&&e.id.length>0||(e.id=M())}function X(){return Q.apply(this,arguments)}function Q(){return(Q=Object(i.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,F.readText(H);case 3:return t=e.sent,e.abrupt("return",JSON.parse(t));case 7:return e.prev=7,e.t0=e.catch(0),n={count:0,records:{}},e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function ee(e){return te.apply(this,arguments)}function te(){return(te=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.writeText(H,JSON.stringify(t));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(e,t){t.records[e.id]=Object(p.a)(Object(p.a)({},e.data),{},{id:e.id})}function ae(e){var t,n=Object(L.a)(e.admissions);try{for(n.s();!(t=n.n()).done;){var a,r=t.value,i=Object(L.a)(r.visits);try{for(i.s();!(a=i.n()).done;){var o=a.value;"string"===typeof o.uuid&&0!==o.uuid.length||(o.uuid=M()),"number"!==typeof o.version&&(o.version=1)}}catch(s){i.e(s)}finally{i.f()}}}catch(s){n.e(s)}finally{n.f()}return e}n(75);var re=o.a.View.Input,ie=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={},e.handleChange=function(t){var n=V.structure;if(!n)return null;e.props.onChange(oe(n,e.props.type,t))},e}return Object(w.a)(n,[{key:"render",value:function(){var e=["view-field-Text"].concat(Object(C.a)(o.a.Converter.StringArray(this.props.className,[]))),t=V.structure;if(!t)return null;var n=this.props.type,a=this.props.value,r=function(e,t){var n=e.types[t];return n?Object.values(n.children).map((function(e){return e.caption})).filter((function(e){return"string"===typeof e})):[]}(t,n);return c.a.createElement(re,{className:e,label:this.props.label,wide:this.props.wide,width:this.props.width,value:se(t,n,a),suggestions:r,onChange:this.handleChange})}}]),n}(c.a.Component);function oe(e,t,n){var a=e.types[t];if(!a)return n;for(var r=n.trim().toLowerCase(),i=0,o=Object.values(a.children);i<o.length;i++){var s=o[i],c=s.caption;if(c&&c.toLowerCase()===r)return s.id}return n}function se(e,t,n){var a=e.types[t];if(!a)return n;var r=a.children[n];return r&&r.caption||n}n(76);var ce=o.a.View.Expand,ue=o.a.View.Checkbox,le=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={},e.renderPrevConsultation=function(t,n){if("undefined"===typeof n.data[t.id])return c.a.createElement("code",null,JSON.stringify(n.data[t.id]));var a=e.getFieldValue(t);return c.a.createElement("div",{className:"prev-field",key:"pc-".concat(n.enter)},c.a.createElement("div",{className:"date"},m.formatDate(m.seconds2date(n.enter))),c.a.createElement("div",{className:"value"},a))},e.updateField=function(t,n){var a=(n||"").trim(),r=e.props.consultation;delete r.data[t.id],a.length>0&&(r.data[t.id]=a,console.info("consultation=",r))},e.updateBooleanField=function(t,n){var a=e.props.consultation;delete a.data[t.id],n&&(a.data[t.id]="#YES")},e}return Object(w.a)(n,[{key:"getFieldValue",value:function(e){var t=this.props.consultation;if(!t)return"";var n=t.data;return n&&n[e.id]||""}},{key:"getFieldValueAsBoolean",value:function(e){var t=this.getFieldValue(e);return"#FALSE"!==o.a.Converter.Enum(t,["#YES","#TRUE"],"#FALSE")}},{key:"renderFields",value:function(e){var t=this;return Object.keys(e).map((function(n){var a=e[n];return a?t.renderField(a):null}))}},{key:"renderField",value:function(e){var t=this;if(function(e){return!!e.children&&Object.keys(e.children).length>0}(e))return c.a.createElement(ce,{key:e.id,label:e.caption,value:!1,className:"thm-ele-button field"},this.renderFields(e.children));var n=this.props.consultation;if(function(e){var t=e.tags;if(!Array.isArray(t))return!1;var n,a=Object(L.a)(t);try{for(a.s();!(n=a.n()).done;){if("BOOL"===n.value.trim().toUpperCase())return!0}}catch(r){a.e(r)}finally{a.f()}return!1}(e))return c.a.createElement(ue,{key:e.id,wide:!0,label:e.caption,value:this.getFieldValueAsBoolean(e),onChange:function(n){return t.updateBooleanField(e,n)}});var a=R.getAllConsultationsBefore(this.props.patient,n.enter);return"#REFERENCE"===e.id&&(console.info("prevConsultations=",a),console.info("consultation=",n)),c.a.createElement("div",{className:"field"},c.a.createElement(ie,{key:e.id,label:e.caption,value:this.getFieldValue(e),type:e.type||"",width:"15rem",wide:!1,onChange:function(n){return t.updateField(e,n)}}),a.map(this.renderPrevConsultation.bind(this,e)))}},{key:"render",value:function(){var e=["view-ConsultationForm"].concat(Object(C.a)(o.a.Converter.StringArray(this.props.className,[]))),t=V.structure;if(!t)return null;var n=t.forms;return c.a.createElement("div",{className:e.join(" ")},this.renderFields(n))}}]),n}(c.a.Component);n(77);var de=o.a.View.Button,pe=o.a.View.InputDate,fe=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).oldPatientSummary=void 0,e.oldConsultationId=void 0,e.state={patient:void 0,consultation:null},e.refresh=Object(i.a)(r.a.mark((function t(){var n,a,i,o,s;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=e.props.patientSummary)===e.oldPatientSummary){t.next=7;break}return e.oldPatientSummary=n,t.next=5,q.getPatient(n.id);case 5:a=t.sent,e.setState({patient:a});case 7:i=e.props.consultationId,(o=e.state.patient)&&i!==e.oldConsultationId&&(e.oldConsultationId=i,s=me(R.getConsultationFromUuid(o,i)),e.setState({consultation:s}));case 10:case"end":return t.stop()}}),t)}))),e.componentDidMount=e.refresh,e.componentDidUpdate=e.refresh,e.handleOK=function(){e.props.onBack(e.state.consultation,e.state.patient)},e.handleCancel=function(){e.props.onBack(null)},e.handleDataChange=function(t){var n=e.state.consultation;n&&(n.enter=Math.floor(t/1e3))},e}return Object(w.a)(n,[{key:"render",value:function(){var e=["view-page-Consultation"].concat(Object(C.a)(o.a.Converter.StringArray(this.props.className,[]))),t=this.state,n=t.patient,a=t.consultation;if(!n)return null;if(!a)return null;var r=R.getSummary(n),i=m.seconds2date(a.enter);return c.a.createElement("div",{className:e.join(" ")},c.a.createElement("header",{className:"thm-bgPD thm-ele-nav"},c.a.createElement("div",null,c.a.createElement(de,{label:S.ok,icon:"ok",small:!0,warning:!0,onClick:this.handleOK}),c.a.createElement(de,{label:S.cancel,icon:"cancel",small:!0,flat:!0,onClick:this.handleCancel})),c.a.createElement("div",{className:"date"},m.formatDate(i)),c.a.createElement(U,{patient:r})),c.a.createElement("section",null,c.a.createElement(pe,{label:S.consultationDate,value:1e3*a.enter,onChange:this.handleDataChange}),c.a.createElement("hr",null),c.a.createElement(le,{patient:n,consultation:a})))}}]),n}(c.a.Component);function me(e){return e?JSON.parse(JSON.stringify(e)):e}n(78);var he=o.a.View.Button,ve=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).renderAdmission=function(t){return c.a.createElement("div",{className:"admission",key:t.enter},t.visits.map(e.renderConsultation))},e.renderConsultation=function(t){var n=m.seconds2date(t.enter);return c.a.createElement(he,{label:m.formatDate(n),icon:"edit",small:!0,dark:!0,className:"consultation",key:t.enter,onClick:function(){return e.props.onConsultationClick(t.uuid)}})},e}return Object(w.a)(n,[{key:"render",value:function(){var e=this.props.patient;if(!e)return null;var t=["view-page-patient-section-Consultations"].concat(Object(C.a)(o.a.Converter.StringArray(this.props.className,[])));return c.a.createElement("div",{className:t.join(" ")},c.a.createElement(he,{icon:"add",label:S.newConsultation}),c.a.createElement("hr",null),0===e.admissions.length&&c.a.createElement("p",null,"Ce-tte patient-e n'a pas encore consult\xe9 ici."),e.admissions.map(this.renderAdmission))}}]),n}(c.a.Component),ge=(n(79),o.a.View.Touchable),be=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={},e.renderVaccin=function(e){var t,n=((null===(t=V.structure)||void 0===t?void 0:t.vaccins)||{})[e]||{caption:"???"};return c.a.createElement(ge,{key:e,className:["thm-ele-button","vaccin"].join(" ")},c.a.createElement("div",null,n.caption))},e}return Object(w.a)(n,[{key:"render",value:function(){var e;if(!this.props.patient)return null;var t=["view-page-patient-section-Vaccins"].concat(Object(C.a)(o.a.Converter.StringArray(this.props.className,[]))),n=Object.keys((null===(e=V.structure)||void 0===e?void 0:e.vaccins)||{});return c.a.createElement("div",{className:t.join(" ")},c.a.createElement("div",{className:"vaccins",style:{gridTemplate:"repeat(".concat(Math.ceil(n.length/3),", 1fr) / repeat(3, 1fr)")}},n.map(this.renderVaccin)),c.a.createElement("p",null,"Cliquez sur un vaccin pour changer sa date."))}}]),n}(c.a.Component),ye=(n(80),o.a.View.Button),Ce=o.a.Layout.TabStrip,Ee=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).oldPatientId="",e.state={patient:void 0},e.refresh=Object(i.a)(r.a.mark((function t(){var n,a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.props.patientSummary,e.oldPatientId!==n.id){t.next=3;break}return t.abrupt("return");case 3:return e.oldPatientId=n.id,t.next=6,q.getPatient(n.id);case 6:a=t.sent,console.info("patient=",a),e.setState({patient:a});case 9:case"end":return t.stop()}}),t)}))),e.componentDidMount=e.refresh,e.componentDidUpdate=e.refresh,e.handleConsultationClick=function(e){console.info("consultationId=",e),b.setConsultationId(e),b.setPage("consultation")},e.handleBack=function(){b.setPage("patients"),b.clearPatient()},e}return Object(w.a)(n,[{key:"render",value:function(){var e=["view-page-Patient"].concat(Object(C.a)(o.a.Converter.StringArray(this.props.className,[])));return c.a.createElement("div",{className:e.join(" ")},c.a.createElement("header",{className:"thm-bgPD thm-ele-nav"},c.a.createElement(ye,{label:S.back,icon:"back",small:!0,warning:!0,onClick:this.handleBack}),c.a.createElement(U,{patient:this.props.patientSummary}),c.a.createElement(ye,{label:S.editPatient,icon:"user",small:!0,warning:!1,onClick:this.handleBack})),c.a.createElement("section",null,c.a.createElement(Ce,{headers:[S.consultations,S.vaccins]},c.a.createElement(ve,{patient:this.state.patient,onConsultationClick:this.handleConsultationClick}),c.a.createElement(be,{patient:this.state.patient}))))}}]),n}(c.a.Component),we=n(13),Oe=(n(81),o.a.View.Input),je=o.a.View.InputDate,ke=o.a.View.InputInteger,Pe=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).oldPatient=void 0,e.state={id:"",lastname:"",firstname:"",secondname:"",gender:"",size:0,country:"",birth:m.createUndefinedDate()},e.refresh=function(){var t=e.props.patient;t!==e.oldPatient&&(e.oldPatient=t,e.setState(Object(p.a)({},t)))},e.componentDidMount=e.refresh,e.componentDidUpdate=e.refresh,e.fireChange=function(){var t=Object(we.a)(e).state;e.props.onChange(Object(p.a)({},t))},e.handleLastnameChange=function(t){e.setState({lastname:t},e.fireChange)},e.handleFirstnameChange=function(t){e.setState({firstname:t},e.fireChange)},e.handleSecondnameChange=function(t){e.setState({secondname:t},e.fireChange)},e.handleCountryChange=function(t){e.setState({country:t},e.fireChange)},e.handleGenderChange=function(t){e.setState({gender:t},e.fireChange)},e.handleSizeChange=function(t){e.setState({size:t},e.fireChange)},e.handleBirthChange=function(t){e.setState({birth:new Date(t)},e.fireChange)},e}return Object(w.a)(n,[{key:"render",value:function(){var e=["view-PatientForm"].concat(Object(C.a)(o.a.Converter.StringArray(this.props.className,[]))),t=this.state,n=t.lastname,a=t.firstname,r=t.secondname,i=t.gender,s=t.birth,u=t.size;return c.a.createElement("div",{className:e.join(" ")},c.a.createElement(Oe,{label:S.lastName,transform:o.a.Util.normalizeLastname,wide:!0,focus:!0,value:n,onChange:this.handleLastnameChange}),c.a.createElement(Oe,{label:S.firstName,transform:o.a.Util.normalizeFirstname,wide:!0,value:a,onChange:this.handleFirstnameChange}),c.a.createElement(Oe,{label:S.secondName,transform:o.a.Util.normalizeFirstname,wide:!0,value:r,onChange:this.handleSecondnameChange}),c.a.createElement(ie,{label:S.gender,wide:!0,type:"#GENDER",value:i,onChange:this.handleGenderChange}),c.a.createElement(je,{label:S.birthday,value:s.getTime(),onChange:this.handleBirthChange}),c.a.createElement(ie,{label:S.country,wide:!0,type:"#COUNTRY",value:"",onChange:this.handleCountryChange}),c.a.createElement(ke,{label:S.size,value:u,onChange:this.handleSizeChange}))}}]),n}(c.a.Component),Se=(n(82),o.a.View.Touchable),Ne=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).handleClick=function(){e.props.onClick(Object(p.a)({},e.props.patientSummary))},e}return Object(w.a)(n,[{key:"render",value:function(){var e=["view-PatientSummaryButton"].concat(Object(C.a)(o.a.Converter.StringArray(this.props.className,[])));return c.a.createElement("div",{className:e.join(" ")},c.a.createElement(Se,{className:"thm-bg1 item",onClick:this.handleClick},c.a.createElement(U,{patient:this.props.patientSummary})))}}]),n}(c.a.Component),xe=function(){function e(t){Object(E.a)(this,e),this._filteredList=void 0,this.patientSummaries=void 0,this.footPrints=void 0,this.patientSummaries=t,this._filteredList=t.slice(),this.footPrints=t.map((function(e){return{id:e.id,firstName:Te(e.firstname),lastName:Te(e.lastname)}}))}return Object(w.a)(e,[{key:"filter",value:function(e,t){var n=this,a=Te(e),r=Te(t);this._filteredList=this.patientSummaries.filter((function(e,t){var i=n.footPrints[t];return Ae(i.lastName,a)&&Ae(i.firstName,r)}))}},{key:"filteredList",get:function(){return this._filteredList.slice()}}]),e}();function Ae(e,t){return 0===t.length||-1!==e.indexOf(t)}var Ie=[["\xe0\xe1\xe4\xe2\xe3","a"],["\xe8\xe9\xeb\xea\u1ebd","e"],["\xec\xed\xef\xee\u0129","i"],["\xf2\xf3\xf6\xf4\xf5","o"],["\xf9\xfa\xfc\xfb\u0169","u"],["\xe7","c"],["\u20ac","e"],["\xf1","n"]];function Te(e){var t,n="",a=Object(L.a)(e.toLowerCase());try{for(a.s();!(t=a.n()).done;){var r=t.value,i=De(r);i?n+=i:-1!=="abcdefghijklmnopqrstuvwxyz".indexOf(r)&&(n+=r)}}catch(o){a.e(o)}finally{a.f()}return n}function De(e){var t,n=Object(L.a)(Ie);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=Object(W.a)(a,2),i=r[0],o=r[1];if(-1!==i.indexOf(e))return o}}catch(s){n.e(s)}finally{n.f()}return null}var Fe=n(26),ze=(n(83),o.a.View.Button),Be=o.a.View.List,Ve=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,s=new Array(a),u=0;u<a;u++)s[u]=arguments[u];return(e=t.call.apply(t,[this].concat(s))).oldPatients=void 0,e.patientsFilter=void 0,e.state={filteredPatients:e.props.patients},e.filter=o.a.Async.Debouncer((function(){var t=Object(we.a)(e).patientsFilter;if(t){var n=e.props.patient;t.filter(n.lastname,n.firstname),e.setState({filteredPatients:t.filteredList})}}),350),e.handlePatientChange=function(t){e.props.onPatientChange(t)},e.renderPatientSummaryButton=function(t){return c.a.createElement(Ne,{patientSummary:t,onClick:e.handlePatientSummaryClick})},e.handlePatientSummaryClick=function(t){console.info("patientSummary=",t),e.props.onPatientChange(t),e.props.onPatientClick(t)},e.handleAddNewPatient=Object(i.a)(r.a.mark((function t(){var n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=R.createPatientFromSummary(e.props.patient),t.next=3,q.setPatient(n);case 3:e.props.onPatientClick(e.props.patient);case 4:case"end":return t.stop()}}),t)}))),e}return Object(w.a)(n,[{key:"componentDidMount",value:function(){this.refreshPatientsFilter()}},{key:"componentDidUpdate",value:function(){this.refreshPatientsFilter()}},{key:"refreshPatientsFilter",value:function(){var e=this.props.patients;e!==this.oldPatients&&(this.oldPatients=e,this.patientsFilter=new xe(e)),this.filter()}},{key:"render",value:function(){if(!this.patientsFilter)return null;var e=["view-page-Patients"].concat(Object(C.a)(o.a.Converter.StringArray(this.props.className,[]))),t=this.props.patient,n=this.state.filteredPatients;return c.a.createElement("div",{className:e.join(" ")},c.a.createElement("header",{className:"thm-bgPD thm-ele-nav"},c.a.createElement(ze,{icon:"close",small:!0,warning:!0,label:"Quitter",onClick:function(){return process.exit(0)}}),c.a.createElement("div",null,"WebSoins Consultations v",Fe.version),c.a.createElement(ze,{label:S.importPatients,small:!0,icon:"import",onClick:function(){return b.setPage("import-patients")}})),c.a.createElement("section",null,c.a.createElement("div",null,c.a.createElement("div",{className:"patients-form thm-bg2 thm-ele-button"},c.a.createElement("h1",null,"Donn\xe9es d\xe9mographiques du patient"),c.a.createElement(Pe,{patient:t,onChange:this.handlePatientChange}),c.a.createElement("p",{className:0===n.length?"hide":""},"Si le ",c.a.createElement("b",null,"patient existe d\xe9j\xe0")," dans la colonne de droite,",c.a.createElement("b",null,"cliquez dessus")," pour voir ses anciennes consultations et \xe9ventuellement en ajouter une nouvelle."),c.a.createElement(ze,{icon:"add",wide:!0,label:"Ajouter un nouveau patient",enabled:Ue(t),warning:!0,onClick:this.handleAddNewPatient})),c.a.createElement("div",{className:"remote-server"},V.remoteServer)),c.a.createElement("div",{className:"patients-list"},c.a.createElement("h1",null,"Patients correspondant au filtre: \xa0",c.a.createElement("big",null,n.length),c.a.createElement("small",null," / ",this.props.patients.length)),c.a.createElement(Be,{className:"list",itemHeight:32,items:this.state.filteredPatients,mapper:this.renderPatientSummaryButton}))))}}]),n}(c.a.Component);function Ue(e){return 0!==e.lastname.trim().length&&(0!==e.firstname.trim().length&&(0!==e.country.trim().length&&!!m.isDefinedDate(e.birth)))}var Le=function(){function e(t,n){Object(E.a)(this,e),this.path=n,this._patientsCount=void 0,this._records=void 0;try{var a=JSON.parse(t);if("number"!==typeof a.count)throw Error('Wrong file format: missing "count" attribute!');if(this._patientsCount=a.count,"object"!==typeof a.records)throw Error('Wrong file format: missing "records" attribute!');if(Array.isArray(a.records))throw Error('Wrong file format: "records" must not be an array!');this._records=a.records,console.info("patients=",a)}catch(r){throw console.log(r),Error('Unable to parse "patients.json" content!')}}return Object(w.a)(e,null,[{key:"create",value:function(){var t=Object(i.a)(r.a.mark((function t(n){var a,i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,F.readText(n);case 2:return a=t.sent,i=n.substr(0,n.length-"patients.json".length),t.abrupt("return",new e(a,i));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),Object(w.a)(e,[{key:"getPatientBio",value:function(e){var t=this._records,n=Object.keys(t)[e];if(!n)throw Error("Invalid patient index #".concat(e,"!"));return R.getSummaryFromRecord(t[n])}},{key:"getPatient",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q.getPatient(t,this.path);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"patientsCount",get:function(){return this._patientsCount}}]),e}(),_e=(n(84),o.a.View.Button),Me=o.a.View.InputFile,Re=o.a.View.Progress,Je=o.a.Layout.Flex,We=o.a.Factory.Dialog,qe=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return(e=t.call.apply(t,[this].concat(o))).state={progress:0,count:0,patient:void 0,addedPatientsCount:0,rejectedPatientsCount:0},e.handleFilesClick=function(){var t=Object(i.a)(r.a.mark((function t(n){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1===n.length){t.next=4;break}return t.next=3,We.error("Veuillez s\xe9lectionner un et un seul fichier.");case 3:return t.abrupt("return");case 4:if(a=n.item(0)){t.next=7;break}return t.abrupt("return");case 7:if(console.info("file=",a),"patients.json"===a.name){t.next=12;break}return t.next=11,We.error('Vous devez s\xe9lectionner un fichier nomm\xe9 "patients.json".');case 11:return t.abrupt("return");case 12:e.setState({progress:1e-6},(function(){return e.importPatients(a.path)}));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleBack=Object(i.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b.setPage("patients"),e.next=3,q.getAllPatients();case 3:t=e.sent,console.info("patients=",t),b.setPatients(t);case 6:case"end":return e.stop()}}),e)}))),e}return Object(w.a)(n,[{key:"importPatients",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n,a,i,o,s,c,u;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Le.create(t);case 2:n=e.sent,a=0,i=0,this.setState({count:n.patientsCount,addedPatientsCount:a,rejectedPatientsCount:i}),o=0;case 7:if(!(o<n.patientsCount)){e.next=35;break}return this.setState({progress:o/n.patientsCount}),e.prev=9,s=n.getPatientBio(o),this.setState({patient:s}),console.info("patientBio=",s),c=s.id,e.next=16,n.getPatient(c);case 16:if(u=e.sent,console.info("patient=",u),!q.exists(u.id)){e.next=23;break}i++,this.setState({rejectedPatientsCount:i}),e.next=27;break;case 23:return a++,this.setState({addedPatientsCount:a}),e.next=27,q.setPatient(u);case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(9),console.error(e.t0);case 32:o++,e.next=7;break;case 35:this.setState({progress:1});case 36:case"end":return e.stop()}}),e,this,[[9,29]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=["view-page-ImportPatient","thm-bg1"].concat(Object(C.a)(o.a.Converter.StringArray(this.props.className,[]))),t=this.state,n=t.progress,a=t.count,r=t.patient,i=n>0&&n<1;return c.a.createElement("div",{className:e.join(" ")},c.a.createElement(Je,null,c.a.createElement(_e,{className:"back-button",icon:"left",label:"Retour",enabled:!i,warning:!0,onClick:this.handleBack}),c.a.createElement("p",null,"Utilisez cet outil pour r\xe9cup\xe9rer des patients depuis une autre base de donn\xe9e.",c.a.createElement("br",null),"Seuls les patients que vous n'avez pas d\xe9j\xe0 dans votre base seront import\xe9s."),c.a.createElement(Me,{accept:".json",icon:"user",label:'Importer le fichier "patients.json"',wide:!0,enabled:!i&&0===a,onClick:this.handleFilesClick})),c.a.createElement("div",{className:"progress ".concat(a>0?"show":"hide")},c.a.createElement(Re,{label:"Importation de ".concat(a," patient").concat(a>1?"s":""," (").concat(Math.floor(.5+100*n),"%)"),value:n,wide:!0,height:"2rem"}),r&&c.a.createElement("div",{className:"patient-desc"},c.a.createElement(U,{patient:r}))),c.a.createElement(Je,null,c.a.createElement("div",null,c.a.createElement("p",null,"Patients import\xe9s :"),c.a.createElement("big",null,this.state.addedPatientsCount)),c.a.createElement("div",null,c.a.createElement("p",null,"Patients d\xe9j\xe0 existants :"),c.a.createElement("big",null,this.state.rejectedPatientsCount))))}}]),n}(c.a.Component),He=(n(85),o.a.Layout.Stack),Ke=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={},e.handlePatientChange=function(t){e.props.onPatientChange(t)},e.handlePatientClick=function(t){e.props.onPatientClick(t)},e.handleEndOfConsultationEdition=function(t,n){e.props.onEndOfConsultationEdition(t,n)},e}return Object(w.a)(n,[{key:"componentDidMount",value:function(){k()}},{key:"render",value:function(){console.log("APP");var e=["App","thm-bg0"].concat(Object(C.a)(o.a.Converter.StringArray(this.props.className,[])));return c.a.createElement("div",{className:e.join(" ")},c.a.createElement(He,{fullscreen:!0,scrollable:!0,value:this.props.page},c.a.createElement(fe,{key:"consultation",consultationId:this.props.consultationId,patientSummary:this.props.patient,onBack:this.handleEndOfConsultationEdition}),c.a.createElement(Ee,{key:"patient",patientSummary:this.props.patient}),c.a.createElement(Ve,{key:"patients",patient:this.props.patient,patients:this.props.patients,onPatientChange:this.handlePatientChange,onPatientClick:this.handlePatientClick}),c.a.createElement(qe,{key:"import-patients"})))}}]),n}(c.a.Component);var Ge=Object(d.b)((function(e){return{consultationId:e.consultationId,page:e.page,patient:e.patient,patients:e.patients}}),(function(e){return{onPatientChange:function(e){b.setPatient(e)},onPatientClick:function(e){b.setPatient(e),b.setPage("patient")},onEndOfConsultationEdition:function(e,t){return Object(i.a)(r.a.mark((function n(){return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e||!t){n.next=4;break}return R.updateConsultation(t,e),n.next=4,q.setPatient(t);case 4:b.setPage("patient");case 5:case"end":return n.stop()}}),n)})))()}}}))(Ke),Ye=o.a.Intl.make(n(86)),$e=/^(#[A-Z0-9-]+)?([^\(@]*)(\([^\)]*\)\+?)?(@[A-Z0-9,-]+)?/;var Ze={parse:function(e){var t={},n=[t];return"string"!==typeof e&&(e="".concat(e)),e.split("\n").forEach((function(e,t){try{if(0===(e=e.trim()).length)return;if("//"===e.substr(0,2))return;if("*"!==e.charAt(0))throw Ye("err-1");var a=function(e){var t=0;for(;"*"==e.charAt(0);)e=e.substr(1),t++;return t}(e);if(e=e.substr(a).trim(),a>n.length)throw Ye("err-2",e,n.length-1,a);for(;n.length>a;)n.pop();var r=function(e){var t={id:"",caption:"",children:{},tags:[]},n=$e.exec(e.trim());if(!n)return t;n[2]&&(t.caption=n[2].trim());if(n[1])t.id=n[1].trim();else{if(!t.caption)throw console.error("line:",e),console.error("item:",t),Error("Missing id and caption!");t.id=t.caption.toUpperCase()}n[3]&&(t.type=n[3].substr(1,n[3].length-2).trim());n[4]&&(t.tags=n[4].trim().substr(1).split(",").map((function(e){return e.trim()})));return t}(e);if("undefined"!==typeof n[n.length-1][r.id])throw Ye("err-3",r.id);n[n.length-1][r.id]=r,n.push(r.children||{})}catch(i){throw{lineNumber:t+1,message:i}}})),t},flattenFormsFields:function(e){var t=[];return function e(t,n,a){Object.keys(t).forEach((function(r){var i=t[r];"string"===typeof i.id&&"#"===i.id.charAt(0)?n.push({id:i.id,caption:i.caption,children:{},tags:[],path:a.slice()}):i.children&&(a.push(i.caption),e(i.children,n,a),a.pop())}))}(e,t,[]),t.sort((function(e,t){var n=e.caption,a=t.caption;return n<a?-1:n>a?1:0})),t}},Xe=o.a.Intl,Qe=function(){return Object(i.a)(r.a.mark((function e(){var t,n,a,i,s,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=V.organizationId,n=V.structureId,a=o.a.WebService.create(V.remoteServer),e.prev=3,e.next=6,a.exec("structure.list",t);case 6:if(i=e.sent,s=i.find((function(e){return e.id===n}))){e.next=10;break}return e.abrupt("return",null);case 10:return console.info("structure=",s),c={id:s.id,organizationId:t,name:s.name,patientFields:nt(s.patient),formFields:at(s),forms:et(s.forms),types:et(s.types),vaccins:tt(s.vaccins),sources:{exams:s.exams,vaccins:s.vaccins,patient:s.patient,forms:s.forms,types:s.types}},console.info("parsedStructure=",c),e.abrupt("return",c);case 16:return e.prev=16,e.t0=e.catch(3),console.error(e.t0),e.abrupt("return",null);case 20:case"end":return e.stop()}}),e,null,[[3,16]])})))()};function et(e){try{return Ze.parse(e)}catch(t){throw console.error("[service/structure/parse] ",t),console.log(e),Error(t)}}function tt(e){var t={};try{for(var n=Ze.parse(e),a=0,r=Object.keys(n);a<r.length;a++){var i=r[a];t[i]={caption:n[i].caption}}}catch(o){console.error("[parsePatient] ",o)}return t}function nt(e){try{var t=Ze.parse(e);return Object.keys(t).map((function(e){var n=t[e];return{id:e,type:n.type||"",caption:Xe.toIntl(n.caption)||""}}))}catch(n){console.error("[parsePatient] ",n)}return[]}function at(e){for(var t={},n=[et(e.forms)];n.length>0;){var a=n.shift();if(a)for(var r=0,i=Object.keys(a);r<i.length;r++){var o=i[r],s=a[o];t[o]={type:"",caption:Xe.toText(Xe.toIntl(s.caption))},s.type&&(t[o].type=s.type),s.children&&n.push(s.children)}}return t}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function rt(){return(rt=Object(i.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return window.addEventListener("keyup",(function(e){"F11"===e.key&&(e.preventDefault(),nw.Window.get().toggleFullscreen())}),!0),console.info("process.env=",Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0})),e.next=4,V.initialize();case 4:return e.next=6,q.getAllPatients();case 6:return t=e.sent,console.info("patients=",t),b.setPatients(t),e.next=11,Qe();case 11:(n=e.sent)&&(V.structure=n),l.a.render(c.a.createElement(d.a,{store:b.store},c.a.createElement(c.a.StrictMode,null,c.a.createElement(Ge,null))),document.getElementById("root"));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}o.a.Theme.register("soin",{white:"#fda",black:"#420",bg0:"#ffcb97",bg1:"#ffdab3",bg2:"#ffe6cc",bg3:"#fff3e6",bgP:"#804924",bgPL:"#b36633",bgPD:"#4d2c16",bgS:"#ff9f30",bgSD:"#ff7f00",bgSL:"#ffbf60"}),o.a.Theme.apply("soin"),o.a.Font.loadJosefin(),function(){rt.apply(this,arguments)}(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[27,1,2]]]);
//# sourceMappingURL=main.ee3afc37.chunk.js.map