(this["webpackJsonpweb-soins-consultations"]=this["webpackJsonpweb-soins-consultations"]||[]).push([[0],{109:function(e,t){e.exports=require("crypto")},110:function(e,t,n){e.exports=n.p+"static/media/consultation.1f2c06a3.svg"},112:function(e){e.exports=JSON.parse('{"name":"web-soins-consultations","version":"1.0.0","private":true,"dependencies":{"@testing-library/jest-dom":"^4.2.4","@testing-library/react":"^9.5.0","@testing-library/user-event":"^7.2.1","@types/jest":"^24.9.1","@types/node":"^12.12.54","@types/react":"^16.9.46","@types/react-dom":"^16.9.8","@types/react-redux":"^7.1.9","@types/uuid":"^8.3.0","jszip":"^3.5.0","markdown-to-jsx":"^7.0.1","nw-react-scripts":"3.4.1","react":"^16.13.1","react-dom":"^16.13.1","react-redux":"^7.2.1","redux":"^4.0.5","tfw":"^0.55.17","typescript":"^3.9.7","uuid":"^8.3.0"},"scripts":{"postbuild":"cd build ; rm -rf web-soins-consultations/ ; find . -type f -exec sha256sum {} \\\\; > package.txt","start":"REACT_APP_WEBSOINS=DEV nw-react-scripts start","build":"nw-react-scripts build","predeploy":"npm run build","deploy":"gh-pages -d build","test":"nw-react-scripts test","eject":"nw-react-scripts eject"},"eslintConfig":{"extends":"nw-react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"main":"index.html","window":{"fullscreen":true,"width":1280,"height":720},"nwBuilder":{"//":"https://github.com/nwjs-community/nw-builder","platforms":["win64"],"version":"latest","flavor":"normal","buildDir":"./build","cacheDir":"./cache","macIcns":"./src/logo.icns"},"devDependencies":{"gh-pages":"^3.1.0"}}')},114:function(e,t,n){e.exports=n(317)},266:function(e,t,n){},267:function(e,t,n){},268:function(e){e.exports=JSON.parse('{"fr":{"add-patient":"Ajouter un nouveau patient","back":"Retour","birthday":"Date de naissance","cancel":"Annuler","click-to-edit":"Cliquez pour \xc9diter","close":"Fermer","code":"Code :","confirm-patient-delete":"\xcates-vous s\xfbr de vouloir supprimer ce-tte patient-e ?","consultation-date":"Date de consultation","consultation":"Consultation","consultations":"Consultations","consultations-count":"Nb Consultations :","country":"Pays","date-min":"Date de d\xe9but","date-max":"Date de fin","delete-patient":"Supprimer le Patient","edit-patient":"Editer le Patient","filter":"Filtre","firstname":"Pr\xe9nom","gender":"Genre","gender-female":"F\xe9minin","gender-male":"Masculin","gender-undefined":"Non d\xe9fini","identifier":"ID","import-patients":"Importer des dossiers patients","lastname":"Nom","loading":"Chargement en cours...","logout":"D\xe9connexion","new-consultation":"Nouvelle consultation","ok":"Valider","patients":"Patients","patients-count":"Nb Patients :","prescriptions":"Prescriptions","secondname":"Second Pr\xe9nom","size":"Taille (cm)","struct":"Structure :","vaccin-date":"Date du dernier vaccin","vaccin-lot":"Num\xe9ro de lot","vaccins":"Vaccins","warning-consultation-date":"Attention ! Il est possible de modifier la date de consultation ainsi que tous les autres champs \xe0 tout moment. Mais, pour \xe9viter de fausser les statistiques, veuillez ne le faire que lorsque c\'est n\xe9cessaire."}}')},269:function(e,t,n){},270:function(e,t,n){},271:function(e,t,n){},272:function(e,t,n){},273:function(e,t,n){},276:function(e,t){e.exports=require("events")},277:function(e,t){e.exports=require("buffer")},306:function(e,t,n){},307:function(e,t,n){},308:function(e,t,n){},309:function(e,t,n){},310:function(e,t,n){},311:function(e,t,n){},312:function(e,t,n){},313:function(e,t,n){},314:function(e,t,n){},315:function(e,t,n){},316:function(e){e.exports=JSON.parse('{"fr":{"err-1":"Une ligne non vide et non comment\xe9e doit toujours commencer par au moins une ast\xe9risque pour indiquer le niveau hi\xe9rarchique.","err-2":"<html>Vous avez saut\xe9 au moins un niveau hi\xe9rarchique:<br/><code>$1</code> !<br/><br/>Vous \xe9tiez au niveau <b>$2</b> et vous d\xe9finissez maintenant le niveau <b>$3</b>.","err-3":"<html>Vous avez d\xe9j\xe0 d\xe9clar\xe9 cet identifiant : <b>$1</b> !"}}')},317:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),i=n(3),c=n(1),o=n.n(c),s=n(0),u=n.n(s),l=n(30),p=n.n(l),d=n(33),f=(n(266),n(6)),m=n(7),h=n(49),v={createUndefinedDate:function(){return new Date(-30610224561e3)},date2seconds:function(e){return Math.floor(.001*e.getTime())},formatDate:function(e){return b.format(e)},isDefinedDate:function(e){if(e instanceof Date)return e.getTime()>-30610224561e3;return!1},seconds2date:function(e){return new Date(1e3*e)}};var b=new Intl.DateTimeFormat(["fr-CM"],{weekday:"long",year:"numeric",month:"long",day:"numeric"});var g={consultationId:"",page:"patients",patient:{id:"",lastname:"",firstname:"",secondname:"",gender:"X",size:0,country:"",birth:v.createUndefinedDate()},patients:[],logs:[]},y=Object(h.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:g,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"add-log":return Object(m.a)(Object(m.a)({},e),{},{logs:[t.log].concat(Object(f.a)(e.logs)).splice(0,1024)});case"set-consultation-id":return Object(m.a)(Object(m.a)({},e),{},{consultationId:t.consultationId});case"set-page":return Object(m.a)(Object(m.a)({},e),{},{page:t.page});case"set-patient":return Object(m.a)(Object(m.a)({},e),{},{patient:t.patient});case"set-patients":return Object(m.a)(Object(m.a)({},e),{},{patients:t.patients});default:return e}}));var w={store:y,clearPatient:function(){x({type:"set-patient",patient:{id:"",firstname:"",secondname:"",lastname:"",birth:new Date,country:"",gender:"",size:0}})},addLog:function(e){x({type:"add-log",log:e})},setConsultationId:function(e){x({type:"set-consultation-id",consultationId:e})},setPage:function(e){x({type:"set-page",page:e})},setPatient:function(e){x({type:"set-patient",patient:e})},setPatients:function(e){x({type:"set-patients",patients:e})}};function x(e){console.trace("DISPATCH",e),y.dispatch(e)}var E=n(5),C=n(4),O=n(10),j=n(9),k=(n(267),function(){var e=document.getElementById("splash-screen");if(e){e.classList.add("vanish");window.setTimeout((function(){return document.body.removeChild(e)}),1e3)}}),P=o.a.Intl.make(n(268)),S={get addPatient(){return P("add-patient")},get back(){return P("back")},get birthday(){return P("birthday")},get cancel(){return P("cancel")},get clickToEdit(){return P("click-to-edit")},get close(){return P("close")},get code(){return P("code")},get confirmDeletePatient(){return P("confirm-patient-delete")},get consultationDate(){return P("consultation-date")},get consultation(){return P("consultation")},get consultations(){return P("consultations")},get consultationsCount(){return P("consultations-count")},get country(){return P("country")},get dateMin(){return P("date-min")},get dateMax(){return P("date-max")},get deletePatient(){return P("delete-patient")},get editPatient(){return P("edit-patient")},get executeQuery(){return P("execute-query")},get extractions(){return P("extractions")},get filter(){return P("filter")},get firstName(){return P("firstname")},get gender(){return P("gender")},genderValue:function(e){switch(e.trim().toUpperCase()){case"M":return P("gender-male");case"F":return P("gender-female");default:return P("gender-undefined")}},get identifier(){return P("identifier")},get importPatients(){return P("import-patients")},get lastName(){return P("lastname")},get loading(){return P("loading")},get logout(){return P("logout")},get newConsultation(){return P("new-consultation")},get ok(){return P("ok")},get patients(){return P("patients")},get patientsCount(){return P("patients-count")},get prescriptions(){return P("prescriptions")},get secondName(){return P("secondname")},get size(){return P("size")},get struct(){return P("struct")},get vaccinDate(){return P("vaccin-date")},get vaccinLot(){return P("vaccin-lot")},get vaccins(){return P("vaccins")},get warningConsultationDate(){return P("warning-consultation-date")}},N=n(8),T=n(80),A=n(81),D=parseInt("0777",8);function I(e,t,n,a){"function"===typeof t?(n=t,t={}):t&&"object"===typeof t||(t={mode:t});var r=t.mode,i=t.fs||A;void 0===r&&(r=D&~process.umask()),a||(a=null);var c=n||function(){};e=T.resolve(e),i.mkdir(e,r,(function(n){if(!n)return c(null,a=a||e);switch(n.code){case"ENOENT":I(T.dirname(e),t,(function(n,a){n?c(n,a):I(e,t,c,a)}));break;default:i.stat(e,(function(e,t){e||!t.isDirectory()?c(n,a):c(null,a)}))}}))}I.sync=function e(t,n,a){n&&"object"===typeof n||(n={mode:n});var r=n.mode,i=n.fs||A;void 0===r&&(r=D&~process.umask()),a||(a=null),t=T.resolve(t);try{i.mkdirSync(t,r),a=a||t}catch(o){switch(o.code){case"ENOENT":a=e(T.dirname(t),n,a),e(t,n,a);break;default:var c;try{c=i.statSync(t)}catch(s){throw o}if(!c.isDirectory())throw o}}return a};var F=window.require("fs"),V=window.require("path"),L={deleteFolder:function(e){return new Promise(function(){var t=Object(i.a)(r.a.mark((function t(n,a){var i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=V.resolve(z,e),t.next=3,_(i);case 3:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}())},exists:function(e){var t=V.resolve(z,e);return F.existsSync(t)},readText:function(e){return new Promise((function(t,n){var a=V.resolve(z,e);F.readFile(a,"utf-8",(function(e,a){e?n(e):t(a)}))}))},writeText:function(e,t){return new Promise((function(n,a){var r=V.resolve(z,e);I(V.dirname(r),(function(e){e?a(e):F.writeFile(r,t,"utf-8",(function(e,t){e?a(e):n(t)}))}))}))}},z=V.resolve(process.cwd(),"data");function _(e){return new Promise((function(t,n){F.readdir(e,{withFileTypes:!0},function(){var a=Object(i.a)(r.a.mark((function a(i,c){var o,s,u,l;return r.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!i){a.next=2;break}return a.abrupt("return",n(i));case 2:o=Object(N.a)(c),a.prev=3,o.s();case 5:if((s=o.n()).done){a.next=23;break}if(u=s.value,l=V.resolve(e,u.name),!u.isFile()){a.next=20;break}return a.prev=9,a.next=12,B(l);case 12:a.next=18;break;case 14:return a.prev=14,a.t0=a.catch(9),n(a.t0),a.abrupt("return");case 18:a.next=21;break;case 20:_(l);case 21:a.next=5;break;case 23:a.next=28;break;case 25:a.prev=25,a.t1=a.catch(3),o.e(a.t1);case 28:return a.prev=28,o.f(),a.finish(28);case 31:F.rmdir(e,(function(e){e&&n(e)})),t();case 33:case"end":return a.stop()}}),a,null,[[3,25,28,31],[9,14]])})));return function(e,t){return a.apply(this,arguments)}}())}))}function B(e){return new Promise((function(t,n){F.unlink(e,(function(e){e?n(e):t()}))}))}var U={remoteServer:"https://web-soins.com",secretCode:"kAcGObgfMr",organizationId:1,structureId:1},M=new(function(){function e(){var t=this;Object(E.a)(this,e),this.data=void 0,this.save=o.a.Async.Debouncer((function(){L.writeText("settings.json",JSON.stringify(t.data))}),300),this.data=U}return Object(C.a)(e,[{key:"initialize",value:function(){var e=Object(i.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,L.readText("settings.json");case 3:if(t=e.sent,"string"===typeof(n=JSON.parse(t)).remoteServer){e.next=7;break}throw Error("Attribute remoteServer must be a string!");case 7:if("string"===typeof n.secretCode){e.next=9;break}throw Error("Attribute secretCode must be a string!");case 9:if("number"===typeof n.organizationId){e.next=11;break}throw Error("Attribute organizationId must be a number!");case 11:if("number"===typeof n.structureId){e.next=13;break}throw Error("Attribute structureId must be a number!");case 13:return U.remoteServer=n.remoteServer,U.secretCode=n.secretCode,U.organizationId=n.organizationId,U.structureId=n.structureId,U.structure=n.structure,e.abrupt("return",!0);case 21:return e.prev=21,e.t0=e.catch(0),console.error("Unable to load settings.json!"),console.error(e.t0),e.abrupt("return",!1);case 26:case"end":return e.stop()}}),e,null,[[0,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"remoteServer",get:function(){return"DEV"===Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_WEBSOINS?"http://localhost:7474/web-soins/":this.data.remoteServer},set:function(e){this.data.remoteServer=e,this.save()}},{key:"secretCode",get:function(){return this.data.secretCode},set:function(e){this.data.secretCode=e,this.save()}},{key:"organizationId",get:function(){return this.data.organizationId},set:function(e){this.data.organizationId=e,this.save()}},{key:"structureId",get:function(){return this.data.structureId},set:function(e){this.data.structureId=e,this.save()}},{key:"structure",get:function(){return this.data.structure},set:function(e){this.data.structure=e,this.save()}}]),e}()),R=(n(269),function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={},e}return Object(C.a)(n,[{key:"render",value:function(){var e=["view-PatientShortDesc"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[]))),t=this.props.patient;if(!t)return null;if(!M.structure)return null;var n=1+(new Date).getFullYear()-t.birth.getFullYear();return u.a.createElement("div",{className:e.join(" "),title:t.id},u.a.createElement("span",{className:"lastname"},t.lastname.toUpperCase()),u.a.createElement("span",{className:"firstname"},t.firstname),function(e){var t=e.secondname;return"string"===typeof t&&(0!==t.trim().length&&"undefined"!==t.trim().toLowerCase())}(t)&&u.a.createElement("span",{className:"secondname"},t.secondname),v.isDefinedDate(t.birth)&&u.a.createElement("span",{className:"age"},n," ",u.a.createElement("em",null,"ans")),t.size>0&&u.a.createElement("span",{className:"size"},t.size," ",u.a.createElement("em",null,"cm")))}}]),n}(u.a.Component));var q=n(320),J=function(){return Object(q.a)()},W={createPatientFromSummary:function(e){var t=J(),n=v.date2seconds(new Date);return{id:t,admissions:[],created:n,attachments:[],data:{id:t,"#PATIENT-LASTNAME":e.lastname,"#PATIENT-FIRSTNAME":e.firstname,"#PATIENT-SECONDNAME":e.secondname,"#PATIENT-BIRTH":v.date2seconds(e.birth),"#PATIENT-GENDER":e.gender,"#PATIENT-COUNTRY":e.country,"#PATIENT-SIZE":e.size},edited:n,exams:[],picture:null,vaccins:{}}},getAllConsultationsBefore:function(e,t){var n,a=[],r=Object(N.a)(e.admissions);try{for(r.s();!(n=r.n()).done;){var i,c=n.value,o=Object(N.a)(c.visits);try{for(o.s();!(i=o.n()).done;){var s=i.value;s.enter<t&&a.push(s)}}catch(u){o.e(u)}finally{o.f()}}}catch(u){r.e(u)}finally{r.f()}return a.sort((function(e,t){return t.enter-e.enter})),a},getConsultationFromUuid:function(e,t){var n,a=Object(N.a)(e.admissions);try{for(a.s();!(n=a.n()).done;){var r,i=n.value,c=Object(N.a)(i.visits);try{for(c.s();!(r=c.n()).done;){var o=r.value;if(o.uuid===t)return o}}catch(s){c.e(s)}finally{c.f()}}}catch(s){a.e(s)}finally{a.f()}return console.warn("No consultation found for Patient ".concat(e.id," with Id ").concat(t,"!")),null},getSummary:function(e){return e.data.id=e.id,H(e.data)},getSummaryFromRecord:H,removeConsultation:function(e,t){var n,a=Object(N.a)(e.admissions);try{for(a.s();!(n=a.n()).done;){var r=n.value;r.visits=r.visits.filter((function(e){return e.uuid!==t}))}}catch(i){a.e(i)}finally{a.f()}return e},setSummary:function(e,t){e.data["#PATIENT-BIRTH"]=v.date2seconds(t.birth),e.data["#PATIENT-COUNTRY"]=t.country,e.data["#PATIENT-FIRSTNAME"]=t.firstname,e.data["#PATIENT-SECONDNAME"]=t.secondname,e.data["#PATIENT-LASTNAME"]=t.lastname,e.data["#PATIENT-GENDER"]=t.gender,e.data["#PATIENT-SIZE"]=t.size},updateConsultation:function(e,t){var n,a=Object(N.a)(e.admissions);try{for(a.s();!(n=a.n()).done;){var r,i=n.value,c=Object(N.a)(i.visits);try{for(c.s();!(r=c.n()).done;){var o=r.value;if(o.uuid===t.uuid)return o.version=1+Math.max(o.version,t.version),o.enter=t.enter,o.data=Object(m.a)({},t.data),e}}catch(s){c.e(s)}finally{c.f()}}}catch(s){a.e(s)}finally{a.f()}return e}};function H(e){return{id:e.id,birth:v.seconds2date(o.a.Converter.Integer(e["#PATIENT-BIRTH"])),country:"".concat(e["#PATIENT-COUNTRY"]),firstname:o.a.Transform.normalizeName("".concat(e["#PATIENT-FIRSTNAME"])),gender:o.a.Converter.Enum(e["#PATIENT-GENDER"],["#F","#M","#X"],"#X"),lastname:o.a.Transform.upperCase("".concat(e["#PATIENT-LASTNAME"])),secondname:o.a.Transform.normalizeName("".concat(e["#PATIENT-SECONDNAME"])),size:o.a.Converter.Integer(e["#PATIENT-SIZE"])}}var Y=n(14),K={deletePatient:function(e){return ee.apply(this,arguments)},getAllPatients:function(){return $.apply(this,arguments)},getPatient:function(e){return X.apply(this,arguments)},getPatientFolder:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:".";return"".concat(t,"/data/").concat(e,"/")},getSummary:function(e){return W.getSummary(e)},exists:function(e){var t="".concat(".","/").concat(e,"/patient.json");return L.exists(t)},setPatient:function(e){return Q.apply(this,arguments)}},G="".concat(".","/patients.json"),Z=new Map;function $(){return($=Object(i.a)(r.a.mark((function e(){var t,n,a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ne();case 3:return t=e.sent,n=Object.keys(t.records).map((function(e){return t.records[e]})).map((function(e){return[e.id,"".concat(e["#PATIENT-LASTNAME"],"\t").concat(e["#PATIENT-FIRSTNAME"],"\t").concat(e["#PATIENT-SECONDNAME"]),e]})),a=n.sort((function(e,t){var n=Object(Y.a)(e,1)[0],a=Object(Y.a)(t,1)[0];return n<a?-1:n>a?1:0})),e.abrupt("return",a.map((function(e){return e[2]})).map(W.getSummaryFromRecord));case 9:return e.prev=9,e.t0=e.catch(0),console.error('Unable to load "'.concat(G,'"!'),e.t0),e.abrupt("return",[]);case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function X(){return(X=Object(i.a)(r.a.mark((function e(t){var n,a,i,c,o=arguments;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>1&&void 0!==o[1]?o[1]:".",e.prev=1,console.info("getPatient() id=",t),!Z.has(t)){e.next=7;break}return a=Z.get(t),console.log("Found Patient #".concat(t," in cache!"),a),e.abrupt("return",a);case 7:return e.next=9,L.readText("".concat(n,"/").concat(t,"/patient.json"));case 9:return i=e.sent,se(c=JSON.parse(i)),Z.set(t,c),console.log("Loaded patient: ",c),e.abrupt("return",c);case 17:throw e.prev=17,e.t0=e.catch(1),console.error("Unable to load patient #".concat(t,"!"),e.t0),e.t0;case 21:case"end":return e.stop()}}),e,null,[[1,17]])})))).apply(this,arguments)}function Q(){return(Q=Object(i.a)(r.a.mark((function e(t){var n,a,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=JSON.stringify(se(t)),te(t),e.next=5,L.writeText("./".concat(t.id,"/patient.json"),n);case 5:return e.next=7,ne();case 7:return a=e.sent,ce(t,a),e.next=11,re(a);case 11:return i=t.id,Z.has(i)&&Z.delete(i),Z.set(i,t),e.abrupt("return",t);case 17:throw e.prev=17,e.t0=e.catch(0),console.error("Unable to save patient #".concat(t.id,"!"),e.t0),e.t0;case 21:case"end":return e.stop()}}),e,null,[[0,17]])})))).apply(this,arguments)}function ee(){return(ee=Object(i.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ne();case 3:return n=e.sent,oe(t,n),e.next=7,re(n);case 7:return e.next=9,L.deleteFolder("./".concat(t));case 9:Z.has(t)&&Z.delete(t),e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(0),console.error("Unable to delete patient #".concat(t,"!"),e.t0),e.t0;case 16:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function te(e){"string"===typeof e.id&&e.id.length>0||(e.id=J())}function ne(){return ae.apply(this,arguments)}function ae(){return(ae=Object(i.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,L.readText(G);case 3:return t=e.sent,e.abrupt("return",JSON.parse(t));case 7:return e.prev=7,e.t0=e.catch(0),n={count:0,records:{}},e.abrupt("return",n);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function re(e){return ie.apply(this,arguments)}function ie(){return(ie=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.writeText(G,JSON.stringify(t));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e,t){t.records[e.id]=Object(m.a)(Object(m.a)({},e.data),{},{id:e.id})}function oe(e,t){delete t.records[e]}function se(e){var t,n=Object(N.a)(e.admissions);try{for(n.s();!(t=n.n()).done;){var a,r=t.value,i=Object(N.a)(r.visits);try{for(i.s();!(a=i.n()).done;){var c=a.value;"string"===typeof c.uuid&&0!==c.uuid.length||(c.uuid=J()),"number"!==typeof c.version&&(c.version=1)}}catch(o){i.e(o)}finally{i.f()}}}catch(o){n.e(o)}finally{n.f()}return e}var ue=o.a.Intl,le={createPatientsFieldsFromStructure:function(){var e=pe(),t={};return e.patientFields.forEach((function(e){t[e.id]=!0})),t},createPatientsFieldsCaptionsFromStructure:function(){var e=pe(),t={};return e.patientFields.forEach((function(e){t[e.id]=ue.toText(e.caption)})),t},getCurrentStructure:pe,getFieldCaption:function(e){var t=pe();if("#"!==e.charAt(0))return e;var n=t.formFields[e];return n?ue.toText(n.caption):e},getValueCaption:function(e,t){if(!e)return t;var n=pe().types[e];if(!n)return t;for(var a=0,r=Object.values(n.children);a<r.length;a++){var i=r[a];if(i.caption&&i.id===t)return i.caption||t}return t}};function pe(){var e=M.structure;if(!e)throw Error("Structure has not been initialized yet!");return e}n(270);var de=o.a.View.Input,fe=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={},e.handleChange=function(t){var n=M.structure;if(!n)return null;e.props.onChange(me(n,e.props.type,t))},e}return Object(C.a)(n,[{key:"render",value:function(){var e=["view-field-Text"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[]))),t=M.structure;if(!t)return null;var n=this.props.type,a=this.props.value,r=function(e,t){var n=e.types[t];return n?Object.values(n.children).map((function(e){return e.caption})).filter((function(e){return"string"===typeof e})):[]}(t,n);return console.log("<Text>.render()"),u.a.createElement(de,{className:e.join(" "),label:this.props.label,wide:this.props.wide,width:this.props.width,value:le.getValueCaption(n,a),suggestions:r,onChange:this.handleChange})}}]),n}(u.a.Component);function me(e,t,n){var a=e.types[t];if(!a)return n;for(var r=n.trim().toLowerCase(),i=0,c=Object.values(a.children);i<c.length;i++){var o=c[i],s=o.caption;if(s&&s.toLowerCase()===r)return o.id}return n}n(271);var he=o.a.View.Expand,ve=o.a.View.Checkbox,be=o.a.View.InputDate,ge=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={},e.renderPrevConsultation=function(t,n){if("undefined"===typeof n.data[t.id])return null;var a=e.getFieldValue(t,n);return u.a.createElement("div",{className:"prev-field",key:"pc-".concat(n.enter)},u.a.createElement("div",{className:"date"},v.formatDate(v.seconds2date(n.enter))),u.a.createElement("div",{className:"value"},a))},e.updateField=function(t,n){var a=(n||"").trim(),r=e.props.consultation;delete r.data[t.id],a.length>0&&(r.data[t.id]=a,console.info("consultation=",r))},e.updateBooleanField=function(t,n){var a=e.props.consultation;delete a.data[t.id],n&&(a.data[t.id]="#YES")},e}return Object(C.a)(n,[{key:"getFieldValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t||this.props.consultation;if(!n)return"";var a=n.data;return a&&a[e.id]?le.getValueCaption(e.type,a[e.id]):""}},{key:"getFieldValueAsBoolean",value:function(e){var t=this.getFieldValue(e);return"#FALSE"!==o.a.Converter.Enum(t,["#YES","#TRUE"],"#FALSE")}},{key:"getFieldValueAsDate",value:function(e){var t=this.getFieldValue(e);return 1e3*o.a.Converter.Integer(t)}},{key:"renderFields",value:function(e){var t=this;return Object.keys(e).map((function(n){var a=e[n];return a?t.renderField(a):null}))}},{key:"renderField",value:function(e){var t=this;if(function(e){return!!e.children&&Object.keys(e.children).length>0}(e))return u.a.createElement(he,{key:e.id,label:e.caption,value:!1,className:"thm-ele-button"},this.renderFields(e.children));if("#CONSULTATION-DATE"===e.id)return console.warn("We have ignore an old field because of it's id: ",e),null;var n=this.props.consultation,a=W.getAllConsultationsBefore(this.props.patient,n.enter);return function(e){var t=e.tags;if(!Array.isArray(t))return!1;var n,a=Object(N.a)(t);try{for(a.s();!(n=a.n()).done;){if("BOOL"===n.value.trim().toUpperCase())return!0}}catch(r){a.e(r)}finally{a.f()}return!1}(e)?u.a.createElement("div",{key:e.id,className:"field",title:e.id},u.a.createElement(ve,{wide:!1,label:e.caption,value:this.getFieldValueAsBoolean(e),onChange:function(n){return t.updateBooleanField(e,n)}}),a.map(this.renderPrevConsultation.bind(this,e))):e.tags.indexOf("DATE")>-1?u.a.createElement("div",{key:e.id,className:"field",title:e.id},u.a.createElement(be,{label:e.caption,value:this.getFieldValueAsDate(e),wide:!1,onChange:function(n){return t.updateField(e,"".concat(.001*n))}}),a.map(this.renderPrevConsultation.bind(this,e))):u.a.createElement("div",{key:e.id,className:"field",title:e.id},u.a.createElement(fe,{label:e.caption,value:this.getFieldValue(e),type:e.type||"",width:"15rem",wide:!1,onChange:function(n){return t.updateField(e,n)}}),a.map(this.renderPrevConsultation.bind(this,e)))}},{key:"render",value:function(){var e=["view-ConsultationForm"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[]))),t=M.structure;if(!t)return null;var n=t.forms;return u.a.createElement("div",{className:e.join(" ")},this.renderFields(n))}}]),n}(u.a.Component);n(272);var ye=o.a.View.Button,we=o.a.View.InputDate,xe=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).oldPatientSummary=void 0,e.oldConsultationId=void 0,e.state={patient:void 0,consultation:null},e.refresh=Object(i.a)(r.a.mark((function t(){var n,a,i,c,o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=e.props.patientSummary)===e.oldPatientSummary){t.next=7;break}return e.oldPatientSummary=n,t.next=5,K.getPatient(n.id);case 5:a=t.sent,e.setState({patient:a});case 7:i=e.props.consultationId,(c=e.state.patient)&&i!==e.oldConsultationId&&(e.oldConsultationId=i,o=Ee(W.getConsultationFromUuid(c,i)),e.setState({consultation:o}));case 10:case"end":return t.stop()}}),t)}))),e.componentDidMount=e.refresh,e.componentDidUpdate=e.refresh,e.handleOK=function(){e.props.onBack(e.state.consultation,e.state.patient)},e.handleCancel=function(){e.props.onBack(null)},e.handleDataChange=function(t){var n=e.state.consultation;n&&(n.enter=Math.floor(t/1e3))},e}return Object(C.a)(n,[{key:"render",value:function(){var e=["view-page-Consultation"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[]))),t=this.state,n=t.patient,a=t.consultation;if(!n)return null;if(!a)return null;var r=W.getSummary(n),i=v.seconds2date(a.enter);return u.a.createElement("div",{className:e.join(" ")},u.a.createElement("header",{className:"thm-bgPD thm-ele-nav"},u.a.createElement("div",null,u.a.createElement(ye,{label:S.ok,icon:"ok",color:"S",onClick:this.handleOK}),u.a.createElement(ye,{label:S.cancel,width:"auto",icon:"cancel",onClick:this.handleCancel})),u.a.createElement("div",{className:"date"},v.formatDate(i)),u.a.createElement(R,{patient:r})),u.a.createElement("section",null,u.a.createElement("div",{className:"consultation-date"},u.a.createElement(we,{label:S.consultationDate,value:1e3*a.enter,onChange:this.handleDataChange}),u.a.createElement("p",{className:"thm-bgSD"},S.warningConsultationDate)),u.a.createElement("hr",null),u.a.createElement(ge,{patient:n,consultation:a})))}}]),n}(u.a.Component);function Ee(e){return e?JSON.parse(JSON.stringify(e)):e}var Ce=n(110),Oe=n.n(Ce),je=(n(273),o.a.View.Button),ke=o.a.View.Touchable,Pe=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).renderAdmission=function(t){return u.a.createElement("div",{className:"admission",key:t.enter},t.visits.map(e.renderConsultation))},e.renderConsultation=function(t){var n=v.seconds2date(t.enter);return u.a.createElement(ke,{onClick:function(){return e.props.onConsultationClick(t.uuid)},key:t.enter,className:"consultation thm-bgPD thm-ele-button"},u.a.createElement("img",{src:Oe.a}),u.a.createElement("div",null,u.a.createElement("div",{className:"title"},S.consultations),u.a.createElement("div",{className:"date"},v.formatDate(n)),u.a.createElement("div",{className:"hint"},S.clickToEdit)))},e}return Object(C.a)(n,[{key:"render",value:function(){var e=this,t=this.props.patient;if(!t)return null;var n=["view-page-patient-section-Consultations"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[])));return u.a.createElement("div",{className:n.join(" ")},u.a.createElement(je,{icon:"add",width:"auto",label:S.newConsultation,onClick:function(){return e.props.onNewConsultationClick()}}),u.a.createElement("hr",null),0===t.admissions.length&&u.a.createElement("p",null,"Ce-tte patient-e n'a pas encore consult\xe9 ici."),t.admissions.sort(Se).map(this.renderAdmission))}}]),n}(u.a.Component);function Se(e,t){return t.enter-e.enter}var Ne=n(111),Te=n.n(Ne),Ae=(n(306),n(81)),De=n(80),Ie=o.a.View.Checkbox,Fe=o.a.View.Button,Ve=o.a.View.Expand,Le=o.a.View.Input,ze=new o.a.Storage.PrefixedLocalStorage("web-soins-consultations/prescription"),_e=["Janvier","F\xe9vrier","Mars","Avril","Mai","Juin","Juillet","Ao\xfbt","Septembre","Octobre","Novembre","D\xe9cembre"],Be=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,c=new Array(a),s=0;s<a;s++)c[s]=arguments[s];return(e=t.call.apply(t,[this].concat(c))).state=Object(m.a)(Object(m.a)({},ze.get("state",{prescripteur:"",service:""})),{},{selection:[]}),e.update=function(t){var n=Object(m.a)(Object(m.a)({},e.state),t);e.setState(n),ze.set("state",n)},e.handlePrint=Object(i.a)(r.a.mark((function t(){var n,a,i,c,s,l,p,d;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.props.patient){t.next=3;break}return t.abrupt("return","");case 3:if(i=Ue(e.state.selection),console.info("pages=",i),c=new Te.a){t.next=9;break}return console.error("Unable to create JSZip object!"),t.abrupt("return");case 9:return t.next=11,e.buildContent(i);case 11:if(s=t.sent,console.info("content=",s),null!==(n=c.folder("META-INF"))&&void 0!==n){t.next=17;break}t.next=22;break;case 17:return t.t0=n,t.next=20,Je("META-INF/manifest.xml");case 20:t.t1=t.sent,t.t0.file.call(t.t0,"manifest.xml",t.t1);case 22:return c.file("content.xml",s),t.t2=c,t.next=26,Je("manifest.rdf");case 26:return t.t3=t.sent,t.t2.file.call(t.t2,"manifest.rdf",t.t3),t.t4=c,t.next=31,Je("meta.xml");case 31:return t.t5=t.sent,t.t4.file.call(t.t4,"meta.xml",t.t5),t.t6=c,t.next=36,Je("mimetype");case 36:return t.t7=t.sent,t.t6.file.call(t.t6,"mimetype",t.t7),t.t8=c,t.next=41,Je("settings.xml");case 41:return t.t9=t.sent,t.t8.file.call(t.t8,"settings.xml",t.t9),t.t10=c,t.next=46,Je("styles.xml");case 46:t.t11=t.sent,t.t10.file.call(t.t10,"styles.xml",t.t11),l=new Date,p=De.resolve(K.getPatientFolder(a.id),"pres-".concat(l.getFullYear(),"-").concat(l.getMonth()+1,"-").concat(l.getDate(),".odt")),console.info("filename=",p);try{d=c.generateNodeStream({type:"nodebuffer",streamFiles:!0,compression:"DEFLATE",compressionOptions:{level:9},mimeType:"application/vnd.oasis.opendocument.text"},(function(e){console.log(">",e.currentFile,e.percent)})),console.info("stream=",d),d.pipe(Ae.createWriteStream(p)).on("error",(function(e){console.error("ERROR:",e)})).on("finish",(function(){console.log("File has been written to the disk."),o.a.Factory.Dialog.info(u.a.createElement("div",null,u.a.createElement("p",null,"Le document a \xe9t\xe9 g\xe9n\xe9r\xe9 avec succ\xe8s et sauvegard\xe9 sur le disque :"),u.a.createElement("small",null,u.a.createElement("code",null,p)))),nw.Shell.openItem(p)}))}catch(r){console.error("Unable to create Zip archive!"),console.error(r)}case 52:case"end":return t.stop()}}),t)}))),e}return Object(C.a)(n,[{key:"setItemSelection",value:function(e,t){var n=this.state.selection.filter((function(t){return t!==e}));t?this.setState({selection:[].concat(Object(f.a)(n),[e])}):this.setState({selection:Object(f.a)(n)})}},{key:"renderSections",value:function(e){var t=this;return Object.keys(e).map((function(n){return t.renderSection(n,e[n])}))}},{key:"renderSection",value:function(e,t){var n=this,a=Object.keys(t).map((function(a){var r=t[a];return u.a.createElement(Ve,{key:"".concat(e,"\n").concat(a),label:a,value:!1},r.map((function(t){return n.renderCheckbox(e,a,t)})))}));return[u.a.createElement("h1",{key:"sectionKey"},e)].concat(Object(f.a)(a))}},{key:"renderCheckbox",value:function(e,t,n){var a=this,r="".concat(e,"\n").concat(t,"\n").concat(n),i=-1!==this.state.selection.indexOf(r);return u.a.createElement(Ie,{label:n,wide:!0,value:i,onChange:function(e){return a.setItemSelection(r,e)}})}},{key:"buildContent",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n,a,i,c,o,s,u,l,p,d,f,m,h,b,g,y,w,x,E,C,O,j;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props.patient){e.next=3;break}return e.abrupt("return","");case 3:return a=W.getSummary(n),i=this.state,c=i.service,o=i.prescripteur,e.next=7,Je("content.head.xml");case 7:s=e.sent,u=Object(N.a)(t);try{for(u.s();!(l=u.n()).done;){p=l.value,d=Object(Y.a)(p,2),f=d[0],m=d[1],h=new Date,s+=qe("text:p",{"text:style-name":"P18"},f),s+=qe("text:p",{"text:style-name":"P2"},qe("text:span",{"text:style-name":"T5"},"Nom du patient : "),qe("text:span",{"text:style-name":"T3"},a.lastname),qe("text:span",{"text:style-name":"T6"},qe("text:tab")),qe("text:span",{"text:style-name":"T5"},"Pr\xe9nom : "),qe("text:span",{"text:style-name":"T3"},a.firstname)),s+=qe("text:p",{"text:style-name":"P1"},qe("text:span",{"text:style-name":"T5"},"Date de naissance : "),qe("text:span",{"text:style-name":"T3"},v.formatDate(a.birth))),s+=qe("text:p",{"text:style-name":"P4"}),s+=qe("text:p",{"text:style-name":"P15"},qe("text:span",{"text:style-name":"T5"},"Date de demande de l'examen : ",qe("text:span",{"text:style-name":"T3"},h.getDate()+" "+_e[h.getMonth()]+" "+h.getFullYear()))),s+=qe("text:p",{"text:style-name":"P15"},qe("text:span",{"text:style-name":"T5"},"Nom du prescripteur : ".concat(o),qe("text:tab"))),s+=qe("text:p",{"text:style-name":"P15"},qe("text:span",{"text:style-name":"T5"},"Nom du service prescripteur de l'examen : ".concat(c),qe("text:tab"))),s+=qe("text:p",{"text:style-name":"Heading_20_2"}),b=Object(N.a)(m);try{for(b.s();!(g=b.n()).done;){y=g.value,w=Object(Y.a)(y,2),x=w[0],E=w[1],s+=qe("text:p",{"text:style-name":"Heading_20_2"},x),C=Object(N.a)(E);try{for(C.s();!(O=C.n()).done;)j=O.value,s+=qe("text:list",{"text:style-name":"L1"},qe("text:list-item",qe("text:p",{"text:style-name":"P16"},"".concat(j," : ").concat(qe("text:tab")))))}catch(r){C.e(r)}finally{C.f()}}}catch(r){b.e(r)}finally{b.f()}}}catch(r){u.e(r)}finally{u.f()}return e.t0="".concat(s),e.next=13,Je("content.foot.xml");case 13:return e.t1=e.sent,e.abrupt("return",e.t0.concat.call(e.t0,e.t1));case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=this.props,n=t.patient,a=t.structure;if(!n||!a)return null;var r=["view-page-patient-section-Prescriptions"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[])));return u.a.createElement("div",{className:r.join(" ")},u.a.createElement("fieldset",null,u.a.createElement("legend",{className:"thm-fgPL"},"Liste des examens \xe0 prescrire"),this.renderSections(a.exams)),u.a.createElement(Le,{label:"Nom du prescripteur",wide:!0,value:this.state.prescripteur,onChange:function(t){return e.update({prescripteur:t})}}),u.a.createElement(Le,{label:"Nom du service prescripteur de l'examen",wide:!0,value:this.state.service,onChange:function(t){return e.update({service:t})}}),u.a.createElement(Fe,{icon:"print",width:"auto",label:"Pr\xe9parer le document pour impression",onClick:this.handlePrint}))}}]),n}(u.a.Component);function Ue(e){var t,n=[],a=Object(f.a)(e).sort(),r=Object(N.a)(a);try{for(r.s();!(t=r.n()).done;){var i=t.value.split("\n"),c=Object(Y.a)(i,3),o=c[0],s=c[1],u=c[2],l=Me(n,o),p=Re(Object(Y.a)(l,2)[1],s);Object(Y.a)(p,2)[1].push(u)}}catch(d){r.e(d)}finally{r.f()}return n}function Me(e,t){var n,a=Object(N.a)(e);try{for(a.s();!(n=a.n()).done;){var r=n.value;if(Object(Y.a)(r,1)[0]===t)return r}}catch(c){a.e(c)}finally{a.f()}var i=[t,[]];return e.push(i),i}function Re(e,t){var n,a=Object(N.a)(e);try{for(a.s();!(n=a.n()).done;){var r=n.value;if(Object(Y.a)(r,1)[0]===t)return r}}catch(c){a.e(c)}finally{a.f()}var i=[t,[]];return e.push(i),i}function qe(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];if(0===n.length)return"<"+e+"/>";if(0===n.length&&"string"===typeof n[0])return"<".concat(e,">").concat(n[0],"</").concat(e,">");for(var r="<".concat(e),i={},c="",o=0,s=n;o<s.length;o++){var u=s[o];"string"===typeof u?c+=u:i=u}for(var l=0,p=Object.keys(i);l<p.length;l++){var d=p[l],f=i[d];r+=" ".concat(d,"=").concat(JSON.stringify(f))}return c.length>0?r+=">".concat(c,"</").concat(e,">"):r+="/>",r}function Je(e){return We.apply(this,arguments)}function We(){return(We=Object(i.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.Util.loadTextFromURL("doc/prescription/".concat(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n(307);var He=o.a.View.Input,Ye=o.a.View.InputDate,Ke=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).handleLotChange=function(t){e.props.onLotChange(t)},e.handleDateChange=function(t){e.props.onDateChange(v.date2seconds(new Date(t)))},e}return Object(C.a)(n,[{key:"render",value:function(){var e=["view-page-patient-section-vaccins-VaccinForm"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[])));return u.a.createElement("div",{className:e.join(" ")},u.a.createElement(Ye,{label:S.vaccinDate,value:v.seconds2date(this.props.date).getTime(),onChange:this.handleDateChange}),u.a.createElement(He,{wide:!0,label:S.vaccinLot,value:this.props.lot,onChange:this.handleLotChange}))}}]),n}(u.a.Component),Ge=(n(308),o.a.View.Touchable),Ze=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).state={},e.renderVaccin=function(t){var n,a=e.props.patient;if(!a)return null;var r=((null===(n=M.structure)||void 0===n?void 0:n.vaccins)||{})[t]||{caption:"???"},i=a.vaccins[t],c=["thm-ele-button","vaccin"],o=i?v.seconds2date(i.date||0):null;if(o){var s=new Date,l=s.getFullYear(),p=s.getMonth(),d=s.getDate(),f=v.date2seconds(new Date(l-5,p,d)),m=v.date2seconds(new Date(l-10,p,d)),h=i.date||0;h<m?c.push("bad"):h<f?c.push("warning"):c.push("good")}return u.a.createElement(Ge,{key:t,onClick:function(){return e.handleVaccinClick(t)}},u.a.createElement("div",{className:c.join(" ")},u.a.createElement("div",null,r.caption),o&&u.a.createElement("div",{className:"date"},v.formatDate(o))))},e}return Object(C.a)(n,[{key:"getVaccinCaption",value:function(e){var t;return(((null===(t=M.structure)||void 0===t?void 0:t.vaccins)||{})[e]||{caption:"???"}).caption}},{key:"handleVaccinClick",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n,a,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props.patient){e.next=3;break}return e.abrupt("return",null);case 3:if(a=n.vaccins[t]||{caption:this.getVaccinCaption(t),lot:""}){e.next=6;break}return e.abrupt("return");case 6:return"undefined"===typeof a.date&&(a.date=v.date2seconds(new Date)),console.info("vaccin=",a),i=Object(m.a)({},a),e.next=11,o.a.Factory.Dialog.confirm(i.caption,u.a.createElement(Ke,{date:i.date||v.date2seconds(v.createUndefinedDate()),lot:i.lot||"",onDateChange:function(e){i.date=e},onLotChange:function(e){i.lot=e}}));case 11:if(e.sent){e.next=14;break}return e.abrupt("return");case 14:this.props.onUpdateVaccin(t,i);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e;if(!this.props.patient)return null;var t=["view-page-patient-section-Vaccins"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[]))),n=Object.keys((null===(e=M.structure)||void 0===e?void 0:e.vaccins)||{});return u.a.createElement("div",{className:t.join(" ")},u.a.createElement("div",{className:"vaccins",style:{gridTemplate:"repeat(".concat(Math.ceil(n.length/3),", 1fr) / repeat(3, 1fr)")}},n.map(this.renderVaccin)),u.a.createElement("p",null,"Cliquez sur un vaccin pour changer sa date."),u.a.createElement("ul",null,u.a.createElement("li",null,"Le ",u.a.createElement("span",{className:"bad"},"rouge")," signifie que le vaccin a ",u.a.createElement("b",null,"plus de 10 ans"),"."),u.a.createElement("li",null,"Le ",u.a.createElement("span",{className:"warning"},"orange")," signifie que le vaccin a ",u.a.createElement("b",null,"entre 5 et 10 ans"),"."),u.a.createElement("li",null,"Le ",u.a.createElement("span",{className:"good"},"vert")," signifie que le vaccin a ",u.a.createElement("b",null,"moins de 5 ans"),".")))}}]),n}(u.a.Component),$e=n(32),Xe=(n(309),o.a.View.Input),Qe=o.a.View.InputDate,et=o.a.View.InputInteger,tt=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).oldPatientSummary="",e.state={id:"",lastname:"",firstname:"",secondname:"",gender:"",size:0,country:"",birth:v.createUndefinedDate()},e.refresh=function(){var t=e.props.patientSummary,n=JSON.stringify(t);e.oldPatientSummary!==n&&(e.oldPatientSummary=n,console.info("newPatientSummary=",n),e.setState(Object(m.a)({},t)))},e.componentDidMount=e.refresh,e.componentDidUpdate=e.refresh,e.fireChange=function(){var t=Object($e.a)(e).state;e.props.onChange(Object(m.a)({},t))},e.handleLastnameChange=function(t){e.setState({lastname:t},e.fireChange)},e.handleFirstnameChange=function(t){e.setState({firstname:t},e.fireChange)},e.handleSecondnameChange=function(t){e.setState({secondname:t},e.fireChange)},e.handleCountryChange=function(t){e.setState({country:t},e.fireChange)},e.handleGenderChange=function(t){e.setState({gender:t},e.fireChange)},e.handleSizeChange=function(t){e.setState({size:t},e.fireChange)},e.handleBirthChange=function(t){e.setState({birth:new Date(t)},e.fireChange)},e}return Object(C.a)(n,[{key:"render",value:function(){console.log("[render()] patient-form");var e=["view-PatientForm"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[]))),t=this.state,n=t.lastname,a=t.firstname,r=t.secondname,i=t.gender,c=t.birth,s=t.country,l=t.size;return u.a.createElement("div",{className:e.join(" ")},u.a.createElement(Xe,{label:S.lastName,transform:o.a.Transform.upperCase,wide:!0,focus:!0,value:n,onChange:this.handleLastnameChange}),u.a.createElement(Xe,{label:S.firstName,transform:o.a.Transform.normalizeName,wide:!1,value:a,onChange:this.handleFirstnameChange}),u.a.createElement(Xe,{label:S.secondName,transform:o.a.Transform.normalizeName,wide:!1,value:r,onChange:this.handleSecondnameChange}),u.a.createElement(fe,{label:S.gender,wide:!1,type:"#GENDER",value:i,onChange:this.handleGenderChange}),u.a.createElement(Qe,{label:S.birthday,value:c.getTime(),onChange:this.handleBirthChange}),u.a.createElement(fe,{label:S.country,wide:!1,type:"#COUNTRY",value:s,onChange:this.handleCountryChange}),u.a.createElement(et,{label:S.size,value:l,onChange:this.handleSizeChange}))}}]),n}(u.a.Component),nt=(n(310),o.a.View.Button),at=o.a.Layout.TabStrip,rt=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,c=new Array(a),s=0;s<a;s++)c[s]=arguments[s];return(e=t.call.apply(t,[this].concat(c))).oldPatientId="",e.state={},e.refresh=Object(i.a)(r.a.mark((function t(){var n,a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.props.patientSummary,e.oldPatientId!==n.id){t.next=3;break}return t.abrupt("return");case 3:return e.oldPatientId=n.id,t.next=6,K.getPatient(n.id);case 6:a=t.sent,console.info("patient=",a),e.setState({patient:a});case 9:case"end":return t.stop()}}),t)}))),e.componentDidMount=e.refresh,e.componentDidUpdate=e.refresh,e.handleConsultationClick=function(e){console.info("consultationId=",e),w.setConsultationId(e),w.setPage("consultation")},e.handleNewConsultationClick=Object(i.a)(r.a.mark((function t(){var n,a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.state.patient){t.next=3;break}return t.abrupt("return");case 3:return a={enter:v.date2seconds(new Date),uuid:J(),version:0,data:{}},0===n.admissions.length&&n.admissions.push({enter:a.enter,visits:[]}),n.admissions[n.admissions.length-1].visits.push(a),t.next=9,K.setPatient(n);case 9:e.setState({patient:Object(m.a)({},n)},(function(){return e.handleConsultationClick(a.uuid)}));case 10:case"end":return t.stop()}}),t)}))),e.handleUpdateVaccin=function(){var t=Object(i.a)(r.a.mark((function t(n,a){var i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.info("handleUpdateVaccin()  ",n,a),i=e.state.patient){t.next=4;break}return t.abrupt("return");case 4:return i.vaccins[n]=a,console.info("patient=",i),t.next=8,K.setPatient(i);case 8:e.setState({patient:Object(m.a)({},i)});case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e.handleBack=function(){w.setPage("patients"),w.clearPatient()},e.handleEditPatient=Object(i.a)(r.a.mark((function t(){var n,a,c;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.state.patient){t.next=3;break}return t.abrupt("return");case 3:a=W.getSummary(n),console.info("patient=",n),console.info("patientSummary=",a),c=o.a.Factory.Dialog.show({title:S.editPatient,content:u.a.createElement("div",null,u.a.createElement(tt,{patientSummary:a,onChange:function(e){return a=Object(m.a)({},e)}}),u.a.createElement("hr",null),u.a.createElement(nt,{label:S.deletePatient,icon:"delete",color:"S",onClick:function(){return e.handleDeletePatient(a.id,c)}})),footer:[u.a.createElement(nt,{label:S.cancel,flat:!0,onClick:function(){return c.hide()}}),u.a.createElement(nt,{label:S.ok,color:"S",onClick:Object(i.a)(r.a.mark((function t(){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return W.setSummary(n,a),t.next=3,K.setPatient(n);case 3:return c.hide(),e.handleBack(),t.t0=w,t.next=8,K.getAllPatients();case 8:t.t1=t.sent,t.t0.setPatients.call(t.t0,t.t1);case 10:case"end":return t.stop()}}),t)})))})]});case 7:case"end":return t.stop()}}),t)}))),e.handleDeletePatient=function(){var t=Object(i.a)(r.a.mark((function t(n,a){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(o.a.Factory.Dialog.confirm(S.deletePatient,u.a.createElement("div",null,S.confirmDeletePatient))){t.next=3;break}return t.abrupt("return");case 3:return a.hide(),t.next=6,K.deletePatient(n);case 6:return t.t0=w,t.next=9,K.getAllPatients();case 9:t.t1=t.sent,t.t0.setPatients.call(t.t0,t.t1),e.handleBack();case 12:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),e}return Object(C.a)(n,[{key:"render",value:function(){var e=["view-page-Patient"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[])));return u.a.createElement("div",{className:e.join(" ")},u.a.createElement("header",{className:"thm-bgPD thm-ele-nav"},u.a.createElement(nt,{label:S.back,icon:"back",onClick:this.handleBack}),u.a.createElement(R,{patient:this.props.patientSummary}),u.a.createElement(nt,{label:S.editPatient,icon:"user",width:"auto",onClick:this.handleEditPatient})),u.a.createElement("section",null,u.a.createElement(at,{headers:[S.consultations,S.vaccins,S.prescriptions]},u.a.createElement(Pe,{patient:this.state.patient,onConsultationClick:this.handleConsultationClick,onNewConsultationClick:this.handleNewConsultationClick}),u.a.createElement(Ze,{patient:this.state.patient,onUpdateVaccin:this.handleUpdateVaccin}),u.a.createElement(Be,{patient:this.state.patient,structure:M.structure}))))}}]),n}(u.a.Component),it=(n(311),o.a.View.Touchable),ct=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).handleClick=function(){e.props.onClick(Object(m.a)({},e.props.patientSummary))},e}return Object(C.a)(n,[{key:"render",value:function(){var e=["view-PatientSummaryButton"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[])));return u.a.createElement("div",{className:e.join(" ")},u.a.createElement(it,{className:"thm-bg1 item",onClick:this.handleClick},u.a.createElement(R,{patient:this.props.patientSummary})))}}]),n}(u.a.Component),ot=function(){function e(t){Object(E.a)(this,e),this._filteredList=void 0,this.patientSummaries=void 0,this.footPrints=void 0,this.patientSummaries=t,this._filteredList=t.slice(),this.footPrints=t.map((function(e){return{id:e.id,firstName:lt(e.firstname),lastName:lt(e.lastname)}}))}return Object(C.a)(e,[{key:"filter",value:function(e,t){var n=this,a=lt(e),r=lt(t);this._filteredList=this.patientSummaries.filter((function(e,t){var i=n.footPrints[t];return st(i.lastName,a)&&st(i.firstName,r)})),this._filteredList.sort((function(e,t){return e.lastname>t.lastname?1:e.lastname<t.lastname?-1:e.firstname>t.firstname?1:e.firstname<t.firstname?-1:e.secondname>t.secondname?1:e.secondname<t.secondname?-1:0}))}},{key:"filteredList",get:function(){return this._filteredList.slice()}}]),e}();function st(e,t){return 0===t.length||-1!==e.indexOf(t)}var ut=[["\xe0\xe1\xe4\xe2\xe3","a"],["\xe8\xe9\xeb\xea\u1ebd","e"],["\xec\xed\xef\xee\u0129","i"],["\xf2\xf3\xf6\xf4\xf5","o"],["\xf9\xfa\xfc\xfb\u0169","u"],["\xe7","c"],["\u20ac","e"],["\xf1","n"]];function lt(e){var t,n="",a=Object(N.a)(e.toLowerCase());try{for(a.s();!(t=a.n()).done;){var r=t.value,i=pt(r);i?n+=i:-1!=="abcdefghijklmnopqrstuvwxyz".indexOf(r)&&(n+=r)}}catch(c){a.e(c)}finally{a.f()}return n}function pt(e){var t,n=Object(N.a)(ut);try{for(n.s();!(t=n.n()).done;){var a=t.value,r=Object(Y.a)(a,2),i=r[0],c=r[1];if(-1!==i.indexOf(e))return c}}catch(o){n.e(o)}finally{n.f()}return null}var dt=n(112),ft=n(113),mt=(n(312),function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(C.a)(n,[{key:"render",value:function(){var e=["custom","view-ConsoleView"];return"string"===typeof this.props.className&&e.push(this.props.className),s.createElement("ul",{className:e.join(" ")},this.props.logs.map((function(e,t){return s.createElement("li",{key:"li-".concat(t)},s.createElement(ft.a,null,e))})))}}]),n}(s.Component));var ht=Object(d.b)((function(e){return{logs:e.logs}}),(function(e){}))(mt),vt=(n(313),o.a.View.Button),bt=o.a.View.List,gt=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,c=new Array(a),s=0;s<a;s++)c[s]=arguments[s];return(e=t.call.apply(t,[this].concat(c))).oldPatient="",e.oldPatients="",e.patientsFilter=void 0,e.state={filteredPatients:e.props.patients},e.componentDidMount=e.refreshPatientsFilter,e.componentDidUpdate=e.refreshPatientsFilter,e.filter=o.a.Async.Debouncer((function(){var t=Object($e.a)(e).patientsFilter;if(t){var n=e.props.patient;t.filter(n.lastname,n.firstname),e.setState({filteredPatients:t.filteredList})}}),350),e.handlePatientChange=function(t){e.props.onPatientChange(t)},e.renderPatientSummaryButton=function(t){return u.a.createElement(ct,{patientSummary:t,onClick:e.handlePatientSummaryClick})},e.handlePatientSummaryClick=function(t){e.props.onPatientChange(t),e.props.onPatientClick(t)},e.handleAddNewPatient=Object(i.a)(r.a.mark((function t(){var n;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=W.createPatientFromSummary(e.props.patient),t.next=3,o.a.Factory.Dialog.wait(S.addPatient,new Promise(function(){var e=Object(i.a)(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.setPatient(n);case 2:return e.next=4,K.getAllPatients();case 4:a=e.sent,w.setPatients(a),t();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:e.props.onPatientClick(W.getSummary(n));case 4:case"end":return t.stop()}}),t)}))),e}return Object(C.a)(n,[{key:"refreshPatientsFilter",value:function(){var e=this.props,t=e.patient,n=e.patients,a=JSON.stringify(t),r=JSON.stringify(n);this.oldPatient===a&&this.oldPatients===r||(this.oldPatient=a,this.oldPatients=r,this.patientsFilter=new ot(n),this.filter())}},{key:"render",value:function(){if(!this.patientsFilter)return null;var e=["view-page-Patients"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[]))),t=this.props.patient,n=this.state.filteredPatients;return u.a.createElement("div",{className:e.join(" ")},u.a.createElement("header",{className:"thm-bgPD thm-ele-nav"},u.a.createElement(vt,{icon:"close",label:"Quitter",onClick:function(){return nw.App.quit()}}),u.a.createElement("div",null,"WebSoins Consultations v",dt.version),u.a.createElement(vt,{width:"auto",label:S.importPatients,icon:"import",onClick:function(){return w.setPage("import-patients")}})),u.a.createElement("section",null,u.a.createElement("div",{className:"flex-col"},u.a.createElement("div",{className:"patients-form thm-bg2 thm-ele-button"},u.a.createElement("h1",null,"Donn\xe9es d\xe9mographiques du patient"),u.a.createElement(tt,{patientSummary:t,onChange:this.handlePatientChange}),u.a.createElement("p",{className:0===n.length?"hide":""},"Si le ",u.a.createElement("b",null,"patient existe d\xe9j\xe0")," dans la colonne de droite,",u.a.createElement("b",null,"cliquez dessus")," pour voir ses anciennes consultations et \xe9ventuellement en ajouter une nouvelle."),u.a.createElement(vt,{icon:"add",wide:!0,label:S.addPatient,enabled:yt(t),color:"S",onClick:this.handleAddNewPatient})),u.a.createElement(ht,null)),u.a.createElement("div",{className:"patients-list"},u.a.createElement("h1",null,"Patients correspondant au filtre: \xa0",u.a.createElement("big",null,n.length),u.a.createElement("small",null," / ",this.props.patients.length)),u.a.createElement(bt,{className:"list",itemHeight:32,items:this.state.filteredPatients,mapper:this.renderPatientSummaryButton}))))}}]),n}(u.a.Component);function yt(e){return 0!==e.lastname.trim().length&&(0!==e.firstname.trim().length&&(0!==e.country.trim().length&&!!v.isDefinedDate(e.birth)))}var wt=function(){function e(t,n){Object(E.a)(this,e),this.path=n,this._patientsCount=void 0,this._records=void 0;try{var a=JSON.parse(t);if("number"!==typeof a.count)throw Error('Wrong file format: missing "count" attribute!');if(this._patientsCount=a.count,"object"!==typeof a.records)throw Error('Wrong file format: missing "records" attribute!');if(Array.isArray(a.records))throw Error('Wrong file format: "records" must not be an array!');this._records=a.records,console.info("patients=",a)}catch(r){throw console.log(r),Error('Unable to parse "patients.json" content!')}}return Object(C.a)(e,null,[{key:"create",value:function(){var t=Object(i.a)(r.a.mark((function t(n){var a,i;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,L.readText(n);case 2:return a=t.sent,i=n.substr(0,n.length-"patients.json".length),t.abrupt("return",new e(a,i));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),Object(C.a)(e,[{key:"getPatientBio",value:function(e){var t=this._records,n=Object.keys(t)[e];if(!n)throw Error("Invalid patient index #".concat(e,"!"));return W.getSummaryFromRecord(t[n])}},{key:"getPatient",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,K.getPatient(t,this.path);case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"patientsCount",get:function(){return this._patientsCount}}]),e}(),xt=(n(314),o.a.View.Button),Et=o.a.View.InputFile,Ct=o.a.View.Progress,Ot=o.a.Layout.Flex,jt=o.a.Factory.Dialog,kt=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,c=new Array(a),o=0;o<a;o++)c[o]=arguments[o];return(e=t.call.apply(t,[this].concat(c))).state={progress:0,count:0,patient:void 0,addedPatientsCount:0,rejectedPatientsCount:0},e.handleFilesClick=function(){var t=Object(i.a)(r.a.mark((function t(n){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(1===n.length){t.next=4;break}return t.next=3,jt.error("Veuillez s\xe9lectionner un et un seul fichier.");case 3:return t.abrupt("return");case 4:if(a=n.item(0)){t.next=7;break}return t.abrupt("return");case 7:if(console.info("file=",a),"patients.json"===a.name){t.next=12;break}return t.next=11,jt.error('Vous devez s\xe9lectionner un fichier nomm\xe9 "patients.json".');case 11:return t.abrupt("return");case 12:e.setState({progress:1e-6},(function(){return e.importPatients(a.path)}));case 13:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.handleBack=Object(i.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w.setPage("patients"),e.next=3,K.getAllPatients();case 3:t=e.sent,console.info("patients=",t),w.setPatients(t);case 6:case"end":return e.stop()}}),e)}))),e}return Object(C.a)(n,[{key:"importPatients",value:function(){var e=Object(i.a)(r.a.mark((function e(t){var n,a,i,c,s,u,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,wt.create(t);case 2:n=e.sent,a=0,i=0,this.setState({count:n.patientsCount,addedPatientsCount:a,rejectedPatientsCount:i}),c=0;case 7:if(!(c<n.patientsCount)){e.next=37;break}return this.setState({progress:c/n.patientsCount}),e.prev=9,s=n.getPatientBio(c),this.setState({patient:s}),console.info("patientBio=",s),u=s.id,e.next=16,n.getPatient(u);case 16:if(l=e.sent,console.info("patient=",l),!K.exists(l.id)){e.next=25;break}return i++,this.setState({rejectedPatientsCount:i}),e.next=23,o.a.Async.sleep(2);case 23:e.next=29;break;case 25:return a++,this.setState({addedPatientsCount:a}),e.next=29,K.setPatient(l);case 29:e.next=34;break;case 31:e.prev=31,e.t0=e.catch(9),console.error(e.t0);case 34:c++,e.next=7;break;case 37:this.setState({progress:1});case 38:case"end":return e.stop()}}),e,this,[[9,31]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=["view-page-ImportPatient","thm-bg1"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[]))),t=this.state,n=t.progress,a=t.count,r=t.patient,i=n>0&&n<1;return u.a.createElement("div",{className:e.join(" ")},u.a.createElement(Ot,null,u.a.createElement(xt,{className:"back-button",icon:"left",label:"Retour",enabled:!i,onClick:this.handleBack}),u.a.createElement("p",null,"Utilisez cet outil pour r\xe9cup\xe9rer des patients depuis une autre base de donn\xe9e.",u.a.createElement("br",null),"Seuls les patients que vous n'avez pas d\xe9j\xe0 dans votre base seront import\xe9s."),u.a.createElement(Et,{accept:".json",icon:"user",label:'Importer le fichier "patients.json"',color:"S",wide:!0,enabled:!i&&0===a,onClick:this.handleFilesClick})),u.a.createElement("div",{className:"progress ".concat(a>0?"show":"hide")},u.a.createElement(Ct,{label:"Importation de ".concat(a," patient").concat(a>1?"s":""," (").concat(Math.floor(.5+100*n),"%)"),value:n,wide:!0,height:"2rem"}),r&&u.a.createElement("div",{className:"patient-desc"},u.a.createElement(R,{patient:r}))),u.a.createElement(Ot,null,u.a.createElement("div",null,u.a.createElement("p",null,"Patients import\xe9s :"),u.a.createElement("big",null,this.state.addedPatientsCount)),u.a.createElement("div",null,u.a.createElement("p",null,"Patients d\xe9j\xe0 existants :"),u.a.createElement("big",null,this.state.rejectedPatientsCount))))}}]),n}(u.a.Component),Pt=(n(315),o.a.Layout.Stack),St=function(e){Object(O.a)(n,e);var t=Object(j.a)(n);function n(){var e;Object(E.a)(this,n);for(var a=arguments.length,r=new Array(a),i=0;i<a;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).handlePatientChange=function(t){e.props.onPatientChange(t)},e.handlePatientClick=function(t){e.props.onPatientClick(t)},e.handleEndOfConsultationEdition=function(t,n){e.props.onEndOfConsultationEdition(t,n)},e}return Object(C.a)(n,[{key:"componentDidMount",value:function(){k()}},{key:"render",value:function(){var e=["App","thm-bg0"].concat(Object(f.a)(o.a.Converter.StringArray(this.props.className,[])));return u.a.createElement("div",{className:e.join(" ")},u.a.createElement(Pt,{fullscreen:!0,scrollable:!0,value:this.props.page},u.a.createElement(xe,{key:"consultation",consultationId:this.props.consultationId,patientSummary:this.props.patient,onBack:this.handleEndOfConsultationEdition}),u.a.createElement(rt,{key:"patient",patientSummary:this.props.patient}),u.a.createElement(gt,{key:"patients",patient:this.props.patient,patients:this.props.patients,onPatientChange:this.handlePatientChange,onPatientClick:this.handlePatientClick}),u.a.createElement(kt,{key:"import-patients"})))}}]),n}(u.a.Component);var Nt=Object(d.b)((function(e){return{consultationId:e.consultationId,page:e.page,patient:e.patient,patients:e.patients}}),(function(e){return{onPatientChange:function(e){w.setPatient(e)},onPatientClick:function(e){w.setPatient(e),w.setPage("patient")},onEndOfConsultationEdition:function(e,t){return Object(i.a)(r.a.mark((function n(){return r.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e||!t){n.next=4;break}return W.updateConsultation(t,e),n.next=4,K.setPatient(t);case 4:w.setPage("patient");case 5:case"end":return n.stop()}}),n)})))()}}}))(St),Tt={synchro:function(e){return At.apply(this,arguments)}};function At(){return(At=Object(i.a)(r.a.mark((function e(t){var n,a,i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=18e4;case 1:return e.prev=2,t("Synchronisation en cours..."),e.next=6,Lt();case 6:return a=e.sent,e.next=9,K.getAllPatients();case 9:return i=e.sent,e.next=12,Dt(a,i,t);case 12:return e.next=14,Ft(a,i,t);case 14:e.next=20;break;case 16:e.prev=16,e.t0=e.catch(2),console.error(e.t0),t("_".concat(e.t0,"_"));case 20:return t("On attend 3 minutes avant nouvel essai."),e.next=23,o.a.Async.sleep(n);case 23:e.next=1;break;case 25:case"end":return e.stop()}}),e,null,[[2,16]])})))).apply(this,arguments)}function Dt(e,t,n){return It.apply(this,arguments)}function It(){return(It=Object(i.a)(r.a.mark((function e(t,n,a){var i;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=n.filter((function(e){return"undefined"===typeof t[e.id]})),a("Nouveau patients \xe0 envoyer au serveur: __".concat(i.length,"__ / ").concat(n.length));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ft(e,t,n){return Vt.apply(this,arguments)}function Vt(){return(Vt=Object(i.a)(r.a.mark((function e(t,n,a){var i,c,o,s,u,l,p,d,f,m,h,v,b;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object(N.a)(n),e.prev=1,i.s();case 3:if((c=i.n()).done){e.next=13;break}return s=c.value,e.next=7,K.getPatient(s.id);case 7:u=e.sent,l=null!==(o=t[u.id])&&void 0!==o?o:{},p=Object(N.a)(u.admissions);try{for(p.s();!(d=p.n()).done;){f=d.value,m=Object(N.a)(f.visits);try{for(m.s();!(h=m.n()).done;)b=h.value,null!==(v=l[b.uuid])&&void 0!==v?v:0}catch(a){m.e(a)}finally{m.f()}}}catch(a){p.e(a)}finally{p.f()}case 11:e.next=3;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),i.e(e.t0);case 18:return e.prev=18,i.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[1,15,18,21]])})))).apply(this,arguments)}function Lt(){return zt.apply(this,arguments)}function zt(){return(zt=Object(i.a)(r.a.mark((function e(){var t,n,a,i,c,s,u,l,p,d,f,m,h,v,b,g,y,w,x;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t="".concat(M.organizationId,"-").concat(M.secretCode),e.next=3,_t("synchro2",{cmd:"status",code:t});case 3:if(-3!==(n=e.sent)){e.next=6;break}throw"Code invalide : ".concat(M.secretCode);case 6:if("string"===typeof n){e.next=8;break}throw"Unknonw result: ".concat(JSON.stringify(n));case 8:a={},i=n.split("\n"),c=Object(N.a)(i);try{for(c.s();!(s=c.n()).done;){u=s.value,l=u.split(":"),p=Object(Y.a)(l,2),d=p[0],f=p[1],m={},a[d]=m,h=Object(N.a)(f.split(";"));try{for(h.s();!(v=h.n()).done;)b=v.value,g=b.split(","),y=Object(Y.a)(g,2),w=y[0],x=y[1],m[w]=o.a.Converter.Integer(x,0)}catch(r){h.e(r)}finally{h.f()}}}catch(r){c.e(r)}finally{c.f()}return e.abrupt("return",a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _t(e,t){return o.a.WebService.create(M.remoteServer).exec(e,t)}var Bt=o.a.Intl.make(n(316)),Ut=/^(#[A-Z0-9-]+)?([^\(@]*)(\([^\)]*\)\+?)?(@[A-Z0-9,-]+)?/;function Mt(e){var t={},n=[t];return"string"!==typeof e&&(e="".concat(e)),e.split("\n").forEach((function(e,t){try{if(0===(e=e.trim()).length)return;if("//"===e.substr(0,2))return;if("*"!==e.charAt(0))throw Bt("err-1");var a=function(e){var t=0;for(;"*"==e.charAt(0);)e=e.substr(1),t++;return t}(e);if(e=e.substr(a).trim(),a>n.length)throw Bt("err-2",e,"".concat(n.length-1),"".concat(a));for(;n.length>a;)n.pop();var r=function(e){var t={id:"",caption:"",children:{},tags:[]},n=Ut.exec(e.trim());if(!n)return t;n[2]&&(t.caption=n[2].trim());if(n[1])t.id=n[1].trim();else{if(!t.caption)throw console.error("line:",e),console.error("item:",t),Error("Missing id and caption!");t.id=t.caption.toUpperCase()}n[3]&&(t.type=n[3].substr(1,n[3].length-2).trim());n[4]&&(t.tags=n[4].trim().substr(1).split(",").map((function(e){return e.trim()})));return t}(e);if("undefined"!==typeof n[n.length-1][r.id])throw Bt("err-3",r.id);n[n.length-1][r.id]=r,n.push(r.children||{})}catch(i){throw{lineNumber:t+1,message:i}}})),t}var Rt={parse:Mt,parseLazy:function(e){try{return Mt(e)}catch(t){return console.error(t),{}}},flattenFormsFields:function(e){var t=[];return function e(t,n,a){Object.keys(t).forEach((function(r){var i=t[r];"string"===typeof i.id&&"#"===i.id.charAt(0)?n.push({id:i.id,caption:i.caption,children:{},tags:[],path:a.slice()}):i.children&&(a.push(i.caption),e(i.children,n,a),a.pop())}))}(e,t,[]),t.sort((function(e,t){var n=e.caption,a=t.caption;return n<a?-1:n>a?1:0})),t}},qt={parse:Jt,parseExams:function(e){var t={};try{for(var n=Rt.parseLazy(e),a=0,r=Object.keys(n);a<r.length;a++){var i=r[a],c=n[i],o=c.caption,s={};t[o]=s;for(var u=0,l=Object.keys(c.children);u<l.length;u++){var p=l[u],d=c.children[p],f=d.caption,m=[];s[f]=m;for(var h=0,v=Object.keys(d.children);h<v.length;h++){var b=v[h],g=d.children[b];m.push(g.caption)}0===m.length&&m.push(f)}}}catch(y){console.error("[parseExams] ",y),console.log("examsDef=",e)}return t},parseFormFields:function(e){var t={},n=[Jt(e.forms)];for(;n.length>0;){var a=n.shift();if(a)for(var r=0,i=Object.keys(a);r<i.length;r++){var c=i[r],s=a[c];t[c]={type:"",caption:o.a.Intl.toText(o.a.Intl.toIntl(s.caption))},s.type&&(t[c].type=s.type),s.children&&n.push(s.children)}}return t},parsePatient:function(e){try{var t=Rt.parse(e);return Object.keys(t).map((function(e){var n=t[e];return{id:e,type:n.type||"",caption:o.a.Intl.toIntl(n.caption)||""}}))}catch(n){console.error("[parsePatient] ",n)}return[]},parseVaccins:function(e){var t={};try{for(var n=Rt.parse(e),a=0,r=Object.keys(n);a<r.length;a++){var i=r[a];t[i]={caption:n[i].caption}}}catch(c){console.error("[parseVaccins] ",c)}return t}};function Jt(e){try{return Rt.parse(e)}catch(t){throw console.error("[service/structure/parse] ",t),console.log(e),Error(t)}}var Wt=function(){return Object(i.a)(r.a.mark((function e(){var t,n,a,i,c,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=M.organizationId,n=M.structureId,a=o.a.WebService.create(M.remoteServer),e.prev=3,e.next=6,a.exec("structure.list",t);case 6:if(i=e.sent,c=i.find((function(e){return e.id===n}))){e.next=10;break}return e.abrupt("return",null);case 10:return console.info("Structure (raw)=",c),s={id:c.id,organizationId:t,name:c.name,patientFields:qt.parsePatient(c.patient),formFields:qt.parseFormFields(c),forms:qt.parse(c.forms),types:qt.parse(c.types),vaccins:qt.parseVaccins(c.vaccins),exams:qt.parseExams(c.exams),sources:{exams:c.exams,vaccins:c.vaccins,patient:c.patient,forms:c.forms,types:c.types}},console.info("Structure (parsed)=",s),e.abrupt("return",s);case 16:return e.prev=16,e.t0=e.catch(3),console.error(e.t0),e.abrupt("return",null);case 20:case"end":return e.stop()}}),e,null,[[3,16]])})))()};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ht(){return(Ht=Object(i.a)(r.a.mark((function e(){var t,n;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.Font.loadJosefin(!0);case 2:return window.addEventListener("keyup",(function(e){"F11"===e.key&&(e.preventDefault(),nw.Window.get().toggleFullscreen())}),!0),console.info("process.env=",Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0})),e.next=6,M.initialize();case 6:return w.addLog("Serveur distant: __".concat(M.remoteServer,"__")),e.next=9,K.getAllPatients();case 9:return t=e.sent,console.info("patients=",t),w.setPatients(t),e.next=14,Wt();case 14:(n=e.sent)&&(M.structure=n),p.a.render(u.a.createElement(d.a,{store:w.store},u.a.createElement(u.a.StrictMode,null,u.a.createElement(Nt,null))),document.getElementById("root")),Tt.synchro(w.addLog);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}o.a.Theme.register("soin",{colorW:"#fda",colorB:"#420",colorE:"#B20",color0:"#ffcb97",color1:"#ffdab3",color2:"#ffe6cc",color3:"#fff3e6",colorP:"#804924",colorPL:"#b36633",colorPD:"#4d2c16",colorS:"#ff9f30",colorSD:"#ff7f00",colorSL:"#ffbf60"}),console.log(o.a.Theme.apply("soin")),function(){Ht.apply(this,arguments)}(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},47:function(e,t){e.exports=require("util")},80:function(e,t){e.exports=require("path")},81:function(e,t){e.exports=require("fs")},83:function(e,t){e.exports=require("stream")}},[[114,1,2]]]);
//# sourceMappingURL=main.37e8f452.chunk.js.map